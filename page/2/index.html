<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="安安静静的当一个码农">
<meta property="og:type" content="website">
<meta property="og:title" content="张雨阳的个人博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="张雨阳的个人博客">
<meta property="og:description" content="安安静静的当一个码农">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="张雨阳的个人博客">
<meta name="twitter:description" content="安安静静的当一个码农">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/">





  <title>张雨阳的个人博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">张雨阳的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            日程表
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/Kafka集群搭建步骤/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="铜豌豆6号">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/timg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张雨阳的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/Kafka集群搭建步骤/" itemprop="url">Kafka集群搭建步骤</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T20:25:00+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/从小白到大白系列-中间件/" itemprop="url" rel="index">
                    <span itemprop="name">从小白到大白系列-中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/21/Kafka集群搭建步骤/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/04/21/Kafka集群搭建步骤/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/04/21/Kafka集群搭建步骤/" class="leancloud_visitors" data-flag-title="Kafka集群搭建步骤">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><div class="table-container">
<table>
<thead>
<tr>
<th>主机名</th>
<th>系统</th>
<th>IP地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>linux-node1</td>
<td>CentOS release 7.2</td>
<td>xx.xxx.xxx.81</td>
</tr>
<tr>
<td>linux-node2</td>
<td>CentOS release 7.2</td>
<td>xx.xxx.xxx.82</td>
</tr>
<tr>
<td>linux-node3</td>
<td>CentOS release 7.2</td>
<td>xx.xxx.xxx.83</td>
</tr>
</tbody>
</table>
</div>
<h2 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h2><div class="table-container">
<table>
<thead>
<tr>
<th>软件名称</th>
<th>使用包名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zookeeper</td>
<td>zookeeper-3.5.4-beta.tar.gz</td>
</tr>
<tr>
<td>Kafka</td>
<td>kafka_2.12-2.2.0.gz</td>
</tr>
<tr>
<td>jdk</td>
<td>jdk-8u181-linux-x64.tar.gz</td>
</tr>
</tbody>
</table>
</div>
<p><img src="/2019/04/21/Kafka集群搭建步骤/kafka\1.png" alt></p>
<p>从上图可以看到，Kafka的集群要依赖于Zookeeper的集群，所以我们要先搭建Zookeeper集群。</p>
<h2 id="Zookeeper集群搭建"><a href="#Zookeeper集群搭建" class="headerlink" title="Zookeeper集群搭建"></a>Zookeeper集群搭建</h2><blockquote>
<p> 以下操作都需要在81、82、83的3台机器进行操作,除了<strong>myid文件的内容</strong>不一样之外, 其他配置均相同。</p>
</blockquote>
<h3 id="创建目录和文件"><a href="#创建目录和文件" class="headerlink" title="创建目录和文件"></a>创建目录和文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该目录用来存放zk数据文件和标识文件</span></span><br><span class="line">$ mkdir -p /app/huajifen/tmp/zookeeper</span><br><span class="line">$ <span class="built_in">cd</span> /app/huajifen/tmp/zookeeper</span><br><span class="line"><span class="comment"># 创建一个myid文件,文件内容三台机器不一样就行</span></span><br><span class="line"><span class="comment"># 我们这里定81机器为1,82机器为2,83机器为3</span></span><br><span class="line">$ vim myid</span><br></pre></td></tr></table></figure>
<h3 id="上传和解压"><a href="#上传和解压" class="headerlink" title="上传和解压"></a>上传和解压</h3><p>将<code>zookeeper-3.5.4-beta.tar.gz</code>上传到<code>/app/huajifen/software</code> 目录下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/</span><br><span class="line"><span class="comment"># 解压文件</span></span><br><span class="line">$ tar -zxf zookeeper-3.5.4-beta.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="复制修改zk配置文件"><a href="#复制修改zk配置文件" class="headerlink" title="复制修改zk配置文件"></a>复制修改zk配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/zookeeper-3.5.4-beta/conf</span><br><span class="line"><span class="comment"># 拷贝配置文件</span></span><br><span class="line">$ cp zoo_sample.cfg zoo.cfg</span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">$ vim zoo.cfg</span><br></pre></td></tr></table></figure>
<p>修改配置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 用于存放内存数据快照的文件夹，同时用于集群的myid文件也存在这个文件夹里。一般修改成自定义的地址</span><br><span class="line">dataDir=/app/huajifen/tmp/zookeeper</span><br><span class="line"># 格式为 server.x=[hostname]:nnnnn[:nnnnn]</span><br><span class="line"># “x”是一个数字，与每个服务器的myid文件中的id是一样的。hostname是服务器的hostname，右边配置两个端口，第一个端口用于Follower和Leader之间的数据同步和其它通信，第二个端口用于Leader选举过程中投票通信。  </span><br><span class="line">server.1=xx.xxx.xxx.81:2888:3888</span><br><span class="line">server.2=xx.xxx.xxx.82:2888:3888</span><br><span class="line">server.3=xx.xxx.xxx.83:2888:3888</span><br></pre></td></tr></table></figure>
<h3 id="启动和验证"><a href="#启动和验证" class="headerlink" title="启动和验证"></a>启动和验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$  <span class="built_in">cd</span> /app/huajifen/software/zookeeper-3.5.4-beta/bin/</span><br><span class="line"><span class="comment"># 启动zk</span></span><br><span class="line">$  ./zkServer.sh start</span><br><span class="line"><span class="comment"># 查看zk状态</span></span><br><span class="line">$  ./zkServer.sh status</span><br></pre></td></tr></table></figure>
<h2 id="Kafka集群的搭建"><a href="#Kafka集群的搭建" class="headerlink" title="Kafka集群的搭建"></a>Kafka集群的搭建</h2><h3 id="上传和解压-1"><a href="#上传和解压-1" class="headerlink" title="上传和解压"></a>上传和解压</h3><p>将<code>kafka_2.12-2.2.0.gz</code>上传到<code>/app/huajifen/software</code> 目录下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/</span><br><span class="line"><span class="comment"># 解压文件</span></span><br><span class="line">$ tar -zxf kafka_2.12-2.2.0.gz</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以下操作需要在81、82、83机器同时进行操作，步骤均一样。</p>
</blockquote>
<h3 id="修改核心配置文件"><a href="#修改核心配置文件" class="headerlink" title="修改核心配置文件"></a>修改核心配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/kafka-2.12-2.2.0/config</span><br><span class="line"><span class="comment"># 编辑核心配置文件</span></span><br><span class="line">$ vim server.properties</span><br></pre></td></tr></table></figure>
<p>修改配置如下:</p>
<p><strong>xx.xxx.xxx.81</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 当前机器在集群中的唯一标识，和zookeeper的myid性质一样</span><br><span class="line">broker.id=81</span><br><span class="line"># The address the socket server listens on. It will get the value returned from </span><br><span class="line"># java.net.InetAddress.getCanonicalHostName() if not configured.</span><br><span class="line">#   FORMAT:</span><br><span class="line">#     listeners = listener_name://host_name:port</span><br><span class="line">#   EXAMPLE:</span><br><span class="line">#     listeners = PLAINTEXT://your.host.name:9092</span><br><span class="line"># 对于ip4 java.net.InetAddress.getCanonicalHostName()</span><br><span class="line"># 基本就是localhost了。然后生产者就会一直卡死，没有反应</span><br><span class="line">listeners=PLANTEXT://xx.xxx.xxx.81:9002</span><br><span class="line"># 消息存放的目录，这个目录可以配置为“，”逗号分割的表达式，num.io.threads要大于这个目录的个数这个目录，如果配置多个目录，新创建的topic他把消息持久化的地方是，当前以逗号分割的目录中，那个分区数最少就放那一个</span><br><span class="line">log.dirs=/app/huajifen/log/kafka</span><br><span class="line"># 设置zookeeper集群的连接端口</span><br><span class="line">zookeeper.connect=xx.xxx.xxx.81:2181/kafka,1xx.xxx.xxx.82:2181/kafka,xx.xxx.xxx.83:2181/kafka</span><br></pre></td></tr></table></figure>
<p><strong>xx.xxx.xxx.82</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">broker.id=82</span><br><span class="line">listeners=PLANTEXT://xx.xxx.xxx.82:9002</span><br><span class="line">log.dirs=/app/huajifen/log/kafka</span><br><span class="line">zookeeper.connect=xx.xxx.xxx.81:2181/kafka,xx.xxx.xxx.82:2181/kafka,xx.xxx.xxx.83:2181/kafka</span><br></pre></td></tr></table></figure>
<p><strong>xx.xxx.xxx.83</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">broker.id=83</span><br><span class="line">listeners=PLANTEXT://xx.xxx.xxx.83:9002</span><br><span class="line">log.dirs=/app/huajifen/log/kafka</span><br><span class="line">zookeeper.connect=xx.xxx.xxx.81:2181/kafka,xx.xxx.xxx.82:2181/kafka,xx.xxx.xxx.83:2181/kafka</span><br></pre></td></tr></table></figure>
<blockquote>
<p>强烈建议<code>broker.id</code>和ip有联系，这样容易定位到问题。</p>
<p>zookeeper连接的时候采用 ip:port/kafka这样的方式。</p>
</blockquote>
<h3 id="启动Kafka集群并测试"><a href="#启动Kafka集群并测试" class="headerlink" title="启动Kafka集群并测试"></a>启动Kafka集群并测试</h3><h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从后台启动Kafka集群（3台都需要启动）</span></span><br><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/kafka-2.12-2.2.0/bin/  </span><br><span class="line">$ ./kafka-server-start.sh -daemon ../config/server.properties</span><br></pre></td></tr></table></figure>
<h4 id="检查服务是否启动"><a href="#检查服务是否启动" class="headerlink" title="检查服务是否启动"></a>检查服务是否启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#执行命令jps</span></span><br><span class="line">$ jps</span><br><span class="line">20348 Jps</span><br><span class="line">4233 QuorumPeerMain</span><br><span class="line">18991 Kafka</span><br></pre></td></tr></table></figure>
<h4 id="创建Topic来验证是否创建成功"><a href="#创建Topic来验证是否创建成功" class="headerlink" title="创建Topic来验证是否创建成功"></a>创建Topic来验证是否创建成功</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建Topic</span></span><br><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/kafka-2.12-2.2.0/bin/ </span><br><span class="line">$ ./kafka-topics.sh --create --bootstrap-server xx.xxx.xxx.81:9092 --replication-factor 3 --partitions 1 --topic <span class="built_in">test</span></span><br><span class="line">$ ./kafka-topics.sh --describe --bootstrap-server xx.xxx.xxx.81:9092 --topic <span class="built_in">test</span></span><br><span class="line">Topic:<span class="built_in">test</span>  PartitionCount:1    ReplicationFactor:3 Configs:</span><br><span class="line">    Topic: <span class="built_in">test</span>  Partition: 0    Leader: 1   Replicas: 1,2,0 Isr: 1,2,0</span><br></pre></td></tr></table></figure>
<ul>
<li>“leader”是负责给定分区的所有读写的节点。每个节点将成为随机选择的分区部分的领导者。</li>
<li>“replicas”是复制此分区日志的节点列表，无论它们是否为领导者，或者即使它们当前处于活动状态。</li>
<li>“isr”是“同步”复制品的集合。这是副本列表的子集，该列表当前处于活跃状态并且已经被领导者捕获。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在一台服务器上创建一个发布者</span></span><br><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/kafka-2.12-2.2.0/bin/ </span><br><span class="line">$ ./kafka-console-producer.sh --broker-list xx.xxx.xxx.81:9092 --topic <span class="built_in">test</span></span><br><span class="line">my <span class="built_in">test</span> message 1</span><br><span class="line">my <span class="built_in">test</span> message 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在另外一台服务器上创建一个订阅者</span></span><br><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/kafka-2.12-2.2.0/bin/ </span><br><span class="line">$ ./kafka-console-consumer.sh --bootstrap-server xx.xxx.xxx.81:9092 --from-beginning --topic <span class="built_in">test</span></span><br><span class="line">my <span class="built_in">test</span> message 1</span><br><span class="line">my <span class="built_in">test</span> message 2</span><br></pre></td></tr></table></figure>
<h4 id="测试容错性"><a href="#测试容错性" class="headerlink" title="测试容错性"></a>测试容错性</h4><p><strong>领导已切换到其中一个关注者，节点1不再处于同步副本集中</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 杀死掉lead节点</span></span><br><span class="line">$ <span class="built_in">kill</span> -9 7564</span><br><span class="line">$ ./kafka-topics.sh --describe --bootstrap-server xx.xxx.xxx.82:9092 --topic <span class="built_in">test</span></span><br><span class="line">Topic: <span class="built_in">test</span>   PartitionCount:1    ReplicationFactor:3 Configs:</span><br><span class="line">Topic: <span class="built_in">test</span>  Partition: 0    Leader: 2   Replicas: 1,2,0 Isr: 2,0</span><br></pre></td></tr></table></figure>
<p><strong>但即使最初接受写入的领导者已经失败，这些消息仍可供消费</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./kafka-console-consumer.sh --bootstrap-server xx.xxx.xxx.82:9092 --from-beginning --topic <span class="built_in">test</span></span><br><span class="line">my <span class="built_in">test</span> message 1</span><br><span class="line">my <span class="built_in">test</span> message 2</span><br></pre></td></tr></table></figure>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p><a href="https://blog.csdn.net/qianshangding0708/article/details/50067483" target="_blank" rel="noopener">Zookeeper配置文件全</a></p>
<p><a href="https://zookeeper.apache.org/doc/r3.3.2/zookeeperAdmin.html#sc_configuration" target="_blank" rel="noopener">Zookeeper官方配置参考</a></p>
<p><a href="https://www.cnblogs.com/jun1019/p/6256371.html" target="_blank" rel="noopener">Kafka配置文件详解</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/FastDFS集群搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="铜豌豆6号">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/timg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张雨阳的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/FastDFS集群搭建/" itemprop="url">FastDFS集群搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T19:03:00+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/从小白到大白系列-中间件/" itemprop="url" rel="index">
                    <span itemprop="name">从小白到大白系列-中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/21/FastDFS集群搭建/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/04/21/FastDFS集群搭建/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/04/21/FastDFS集群搭建/" class="leancloud_visitors" data-flag-title="FastDFS集群搭建">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="FastDFS集群搭建"><a href="#FastDFS集群搭建" class="headerlink" title="FastDFS集群搭建"></a>FastDFS集群搭建</h1><h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><div class="table-container">
<table>
<thead>
<tr>
<th>主机名</th>
<th>系统</th>
<th>IP地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>linux-node1</td>
<td>CentOS release 7.2</td>
<td>xx.xxx.xxx.81</td>
</tr>
<tr>
<td>linux-node2</td>
<td>CentOS release 7.2</td>
<td>xx.xxx.xxx.82</td>
</tr>
<tr>
<td>linux-node3</td>
<td>CentOS release 7.2</td>
<td>xx.xxx.xxx.83</td>
</tr>
</tbody>
</table>
</div>
<h2 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h2><div class="table-container">
<table>
<thead>
<tr>
<th>软件名称</th>
<th>使用包名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>FastDFS</td>
<td>FastDFS_v5.05.tar.gz、fastdfs-nginx-module_v1.16.tar.gz、libfastcommon-1.0.39.tar.gz</td>
</tr>
<tr>
<td>Nginx</td>
<td>nginx-1.6.2.tar.gz</td>
</tr>
</tbody>
</table>
</div>
<p> 部署如下图:<img src="/2019/04/21/FastDFS集群搭建/fastDFS\1.png" alt></p>
<p><a href="https://blog.csdn.net/u012453843/article/details/68957209" target="_blank" rel="noopener">手把手教你搭建FastDFS集群上</a></p>
<p><a href="https://blog.csdn.net/u012453843/article/details/69055570" target="_blank" rel="noopener">手把手教你搭建FastDFS集群中</a></p>
<p><a href="https://blog.csdn.net/u012453843/article/details/69172423" target="_blank" rel="noopener">手把手教你搭建FastDFS集群下</a></p>
<blockquote>
<p>上面的教程非常的详细，非常感激博主的分享，完全按照上面的步骤一步步走一定可以搭建成功的。请务必要拥有root账号,  由于机器的限制，需要注意的是我们的group只有一个。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/20/Redis主从+哨兵机制搭建步骤/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="铜豌豆6号">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/timg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张雨阳的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/20/Redis主从+哨兵机制搭建步骤/" itemprop="url">Redis主从+哨兵机制搭建步骤</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-20T21:10:23+08:00">
                2019-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/从小白到大白系列-中间件/" itemprop="url" rel="index">
                    <span itemprop="name">从小白到大白系列-中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/20/Redis主从+哨兵机制搭建步骤/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/04/20/Redis主从+哨兵机制搭建步骤/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/04/20/Redis主从+哨兵机制搭建步骤/" class="leancloud_visitors" data-flag-title="Redis主从+哨兵机制搭建步骤">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><div class="table-container">
<table>
<thead>
<tr>
<th>主机名</th>
<th>系统</th>
<th>IP地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>linux-node1</td>
<td>CentOS release 7.2</td>
<td>xx.xxx.xxx.01</td>
</tr>
<tr>
<td>linux-node2</td>
<td>CentOS release 7.2</td>
<td>xx.xxx.xxx.02</td>
</tr>
<tr>
<td>linux-node3</td>
<td>CentOS release 7.2</td>
<td>xx.xxx.xxx.03</td>
</tr>
</tbody>
</table>
</div>
<h2 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h2><div class="table-container">
<table>
<thead>
<tr>
<th>软件名称</th>
<th>使用包名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>Redis</td>
<td>redis-5.0.4.tar.gz</td>
</tr>
</tbody>
</table>
</div>
<p>Redis版本: 5.0.4</p>
<p><img src="/2019/04/20/Redis主从+哨兵机制搭建步骤/redis\5.jpg" alt></p>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><h3 id="公共操作"><a href="#公共操作" class="headerlink" title="公共操作"></a>公共操作</h3><blockquote>
<p><strong>以下操作都需要在</strong>  <strong>xx.xxx.xxx.01</strong>、<strong>xx.xxx.xxx.02</strong>、<strong>xx.xxx.xxx.03</strong>上面执行**</p>
</blockquote>
<h4 id="安装工具"><a href="#安装工具" class="headerlink" title="安装工具"></a>安装工具</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install gcc gcc-c++ make cmake tcl -y</span><br></pre></td></tr></table></figure>
<h4 id="创建基本目录"><a href="#创建基本目录" class="headerlink" title="创建基本目录"></a>创建基本目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /app/huajifen/redis/log</span><br><span class="line">$ mkdir -p /app/huajifen/redis/sentinel</span><br></pre></td></tr></table></figure>
<h4 id="上传并解压"><a href="#上传并解压" class="headerlink" title="上传并解压"></a>上传并解压</h4><p>上传<code>redis-5.0.4.tar.gz</code>到<code>/app/huajifen/software</code>目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software</span><br><span class="line">$ tar -zxf redis-5.0.4.tar.gz</span><br></pre></td></tr></table></figure>
<h4 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> redis-5.0.4</span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h4 id="修改redis配置文件"><a href="#修改redis配置文件" class="headerlink" title="修改redis配置文件"></a>修改redis配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/redis-5.0.4</span><br><span class="line">$ vim redis.conf</span><br></pre></td></tr></table></figure>
<p>修改配置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"># 修改绑定的ip</span><br><span class="line">bind xx.xxx.xxx.01</span><br><span class="line"># 默认的保护模式的开启的,这样将只有127.0.0.1能访问到,如果需要其他主机访问,需要关闭它</span><br><span class="line">protected-mode no</span><br><span class="line"># 设置客户端连接时的超时时间，单位为秒。当客户端在这段时间内没有发出任何指令,那么关闭该连接,0代表禁用,默认是0。</span><br><span class="line">timeout 2</span><br><span class="line"># 如果不是0，使用SO_KEEPALIVE发送TCP ACKs（响应包）给没有交流的客户端。此配置对两点很有用：</span><br><span class="line"># 1）检查已掉线客户端</span><br><span class="line"># 2）从网络设备的角度考虑中间活着的连接</span><br><span class="line"># 指定ACKs的时间周期，单位为秒，值非0的情况表示将周期性的检测客户端是否可用，默认值为300</span><br><span class="line"># 在Linux系统上，指定的值是用于发送ACKs的周期（以秒为单位）。</span><br><span class="line"># 此处推荐的合理值为60秒</span><br><span class="line">tcp-keepalive 60</span><br><span class="line"># 默认情况下，Redis不以后台程序运行，如果需要，将‘no’改为‘yes’.</span><br><span class="line">daemonize yes</span><br><span class="line"># 当以后台程序方式运行时，在此处指定指定进程ID文件路径与名称。</span><br><span class="line">pidfile &quot;/app/huajifen/redis/redis_6379.pid&quot;</span><br><span class="line"># 指定记录日志文件名称，也可以使用空字符串来强制Redis将日志输出到标准输出。</span><br><span class="line"># 注：如果是Redis是后台运行，如果是标准输出，将输出到/dev/null</span><br><span class="line">logfile &quot;/app/huajifen/redis/log/redis_6369.log&quot;</span><br><span class="line"># 设置复制储备大小。复制储备是一个缓冲器，用来存放某些时候slaves与master断开连接时slave的数据，这样当</span><br><span class="line"># 一个slave重新连接到master时，就不需要一个全部的再次同步，只需要一个部分的再同步仅传送slave断开连接</span><br><span class="line"># 后丢失的数据）即可。</span><br><span class="line"># 默认1mb</span><br><span class="line"># 会出现问题,参考如下</span><br><span class="line"># https://github.com/antirez/redis/issues/1400</span><br><span class="line"># http://zhmgz.lofter.com/post/90909_bbabd6b</span><br><span class="line">repl-backlog-size 512mb</span><br><span class="line"># 在master主服务与slave从服务断开连接后一段时间，复制储备（replication backlog）将会被释放。</span><br><span class="line"># 此处即为设置断开连接后多久复制储备被释放，如果为0，则永不释放。</span><br><span class="line">repl-backlog-ttl 0</span><br><span class="line"># 数据库存放目录。必须是一个目录，aof文件也会保存到该目录下</span><br><span class="line">dir &quot;/app/huajifen/redis&quot;</span><br><span class="line"># 如果主服务处理密码保护状态（在下边使用requirepass指令），它会告诉从服务在开启同步复制进程</span><br><span class="line"># 进行认证，否则主服务拒绝从服务请求</span><br><span class="line"># 搭建集群时不要设置密码</span><br><span class="line">masterauth &quot;huajifen&quot;</span><br><span class="line"># 配置登录Redis服务密码。配置了此项，客户端需要先执行AUTH &lt;PASSWORD&gt;命令，然后才能执行其他命令。</span><br><span class="line">requirepass &quot;huajifen&quot;</span><br><span class="line"># 重命名命令名称</span><br><span class="line"># 在共享环境下可以改变一些危险命令的名字，以避免命令滥用造成的问题。如：</span><br><span class="line"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span><br><span class="line"># 如果将命令重命名为空，则表示干掉此命令。</span><br><span class="line"># rename-command CONFIG &quot;&quot;</span><br><span class="line"># 这里不要重命名config命令，否则哨兵选举将导致选举失败。重写配置文件需要config命令</span><br><span class="line">rename-command FLUSHALL HUAJIFEN_FLUSHALL</span><br><span class="line">rename-command FLUSHDB  HUAJIFEN_FLUSHDB</span><br><span class="line">rename-command KEYS     HUAJIFEN_KEYS</span><br><span class="line"># 指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key，当此方法处理后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区，格式：maxmemory &lt;bytes&gt;</span><br><span class="line">maxmemory 40gb</span><br><span class="line"># 最大内存策略：即当达到最大内存时Redis的行为：</span><br><span class="line"># 1）volatile-lru：驱逐keys，尝试优先删除最近使用的最少的keys，但只在已过期的keys中删除。</span><br><span class="line"># 2）allkeys-lru：驱逐keys，尝试优先删除最近使用的最少的keys。</span><br><span class="line"># 3）volatile-random：随机驱逐keys以便给新添数据腾地方，但仅在已过期keys中随机驱逐。</span><br><span class="line"># 4）allkeys-random：随机驱逐keys以便给新添数据腾地方。</span><br><span class="line"># 5）volatile-ttl：为了给新增数据腾地方，驱逐已过期的keys，和试图优先驱逐最短生存时间keys。</span><br><span class="line"># 6）noeviction：不删除内存中key，只是返回一个写操作错误。</span><br><span class="line"># 注：对于前五种策略，当内存中不存在可以删除的key时都会报一个写操作错误。</span><br><span class="line">maxmemory-policy allkeys-lru</span><br><span class="line"># 默认情况下，Reids异步的将数据集备份到磁盘。这种模式对于大多数应用程序都够使了,但是如果Redis进程问题或者断电事帮可能会导致少量写操作丢失（依据配置的保存点而定）。Append Only File（AOF）是Redis提供的另一种持久化模式。例如使用默信的数据fsync策略（稍后在配置文件中看），在像断电或者Redis进程自身发生的的某个写操作出错这样的事故中Redis可以只丢失1秒的写操作，并且系统还可以正确的运行。AOF和RDB持久化可以同时启用。如果AOF机制启用，Redis启用时将加载AOF文件，AOF文件可提供 。</span><br><span class="line">appendonly yes</span><br><span class="line"># Redis可以通知Pub/sub客户端关于key空间发生的事件。关于此功能的文档地址：</span><br><span class="line"># 例如：如果key空间事件通知是启用的，并且一个客户端在数据库0的key “foo”上执行了一个删除操作，</span><br><span class="line"># 将通过Pub/Sub发布两条信息：</span><br><span class="line"># 1）PUBLISH __keyspace@0__:foo del 427 </span><br><span class="line"># 2）PUBLISH __keyevent@0__:del foo 428 </span><br><span class="line"># 以下为配置，如果为空，则表示禁用。</span><br><span class="line"># K     Keyspace events, published with __keyspace@&lt;db&gt;__ prefix.</span><br><span class="line"># E     Keyevent events, published with __keyevent@&lt;db&gt;__ prefix.</span><br><span class="line"># g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</span><br><span class="line"># $     String commands</span><br><span class="line"># l     List commands</span><br><span class="line"># s     Set commands</span><br><span class="line"># h     Hash commands</span><br><span class="line"># z     Sorted set commands</span><br><span class="line"># x     Expired events (events generated every time a key expires)</span><br><span class="line"># e     Evicted events (events generated when a key is evicted for maxmemory)</span><br><span class="line"># A     Alias for g$lshzxe, so that the &quot;AKE&quot; string means all the events.</span><br><span class="line">notify-keyspace-events &quot;Ex&quot;</span><br></pre></td></tr></table></figure>
<h4 id="修改哨兵文件配置"><a href="#修改哨兵文件配置" class="headerlink" title="修改哨兵文件配置"></a>修改哨兵文件配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/redis-5.0.4</span><br><span class="line">$ vim sentinel.conf</span><br></pre></td></tr></table></figure>
<p>修改配置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 默认的保护模式的开启的,这样将只有127.0.0.1能访问到,如果需要其他主机访问,需要关闭它</span><br><span class="line">protected-mode no</span><br><span class="line"># 默认情况下，sentinel不以后台程序运行，如果需要，将‘no’改为‘yes’.</span><br><span class="line">daemonize yes</span><br><span class="line"># 当以后台程序方式运行时，在此处指定指定进程ID文件路径与名称。</span><br><span class="line">pidfile &quot;/app/huajifen/redis/redis-sentinel.pid&quot;</span><br><span class="line"># 指定记录日志文件名称，也可以使用空字符串来强制sentinel将日志输出到标准输出。</span><br><span class="line"># 注：如果是sentinel是后台运行，如果是标准输出，将输出到/dev/null</span><br><span class="line">logfile &quot;/app/huajifen/redis/log/redis-sentinel.log&quot;</span><br><span class="line"># 工作线程的工作目录</span><br><span class="line">dir &quot;/app/huajifen/redis/sentinel&quot;</span><br><span class="line"># 告诉sentinel去监听地址为ip:port的一个master，这里的master-name可以自定义，quorum是一个数字，指明当有多少个sentinel认为一个master失效时，master才算真正失效。master-name只能包含英文字母，数字，和“.-_”这三个字符需要注意的是master-ip 要写真实的ip地址而不要用回环地址（127.0.0.1）。</span><br><span class="line">sentinel monitor mymaster xx.xxx.xxx.01 6379 2</span><br><span class="line"># 设置连接master和slave时的密码，注意的是sentinel不能分别为master和slave设置不同的密码，因此master和slave的密码应该设置相同。</span><br><span class="line">sentinel auth-pass mymaster huajifen</span><br></pre></td></tr></table></figure>
<h3 id="Slave-xx-xxx-xxx-02-03-节点修改"><a href="#Slave-xx-xxx-xxx-02-03-节点修改" class="headerlink" title="Slave(  xx.xxx.xxx.02/03)节点修改"></a>Slave(  xx.xxx.xxx.02/03)节点修改</h3><h4 id="修改redis配置文件-1"><a href="#修改redis配置文件-1" class="headerlink" title="修改redis配置文件"></a>修改redis配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/redis-5.0.4</span><br><span class="line">$ vim redis.conf</span><br></pre></td></tr></table></figure>
<p>修改配置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 指定初始的master节点</span><br><span class="line">slaveof xx.xxx.xxx.01 6379</span><br></pre></td></tr></table></figure>
<h2 id="启动和验证"><a href="#启动和验证" class="headerlink" title="启动和验证"></a>启动和验证</h2><h3 id="启动Redis"><a href="#启动Redis" class="headerlink" title="启动Redis"></a>启动Redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/redis-5.0.4/bin</span><br><span class="line">$ ./redis-server ../redis.conf</span><br></pre></td></tr></table></figure>
<blockquote>
<p>先启动01、02、03机器上的redis服务。</p>
</blockquote>
<h3 id="验证Redis"><a href="#验证Redis" class="headerlink" title="验证Redis"></a>验证Redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/redis-5.0.4/bin</span><br><span class="line">$ ./redis-cli -h 10.194.131.81 -a huajifen</span><br><span class="line"><span class="comment"># 分别查看节点信息状态</span></span><br><span class="line">$ info replication</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分别查看01、02、03机器上节点的状态。</p>
</blockquote>
<h3 id="启动哨兵"><a href="#启动哨兵" class="headerlink" title="启动哨兵"></a>启动哨兵</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /app/huajifen/software/redis-5.0.4/bin</span><br><span class="line">$ ./redis-sentinel ../sentinel.conf</span><br></pre></td></tr></table></figure>
<blockquote>
<p>先启动01、02、03机器上的sentinel服务。</p>
</blockquote>
<h3 id="验证哨兵"><a href="#验证哨兵" class="headerlink" title="验证哨兵"></a>验证哨兵</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./redis-cli -h xx.xxx.xxx.01 -a huajifen</span><br><span class="line"><span class="comment"># 分别查看redis-sentinel状态</span></span><br><span class="line">$ info sentinel</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分别查看01、02、03机器上哨兵节点的状态。</p>
</blockquote>
<h3 id="验证哨兵选举机制"><a href="#验证哨兵选举机制" class="headerlink" title="验证哨兵选举机制"></a>验证哨兵选举机制</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kill -9 掉master 进程，看是否有master切换即可</span></span><br><span class="line">$ <span class="built_in">kill</span> -9 &lt;masterPid&gt;</span><br><span class="line"><span class="comment"># 进入其他redis节点</span></span><br><span class="line">$ ./redis-cli -h xx.xxx.xxx.02 -a huajifen</span><br><span class="line">$ ./redis-cli -h xx.xxx.xxx.03 -a huajifen</span><br><span class="line"><span class="comment"># 查看节点信息,是否已经切换主节点</span></span><br><span class="line">$ info replication</span><br></pre></td></tr></table></figure>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="Redis完整配置文件"><a href="#Redis完整配置文件" class="headerlink" title="Redis完整配置文件"></a>Redis完整配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br></pre></td><td class="code"><pre><span class="line"># Redis配置文件示例.</span><br><span class="line">#</span><br><span class="line"># 注意为了读取配置文件，必须将文件路径作为Redis启动时的第一个参数：</span><br><span class="line"># ./redis-server /path/to/redis.conf</span><br><span class="line"></span><br><span class="line"># 当需要配置内存大小时，可能通常以1k,5GB,4M等的形式指定，单位换算如下： </span><br><span class="line">#</span><br><span class="line"># 1k =&gt; 1000 bytes</span><br><span class="line"># 1kb =&gt; 1024 bytes</span><br><span class="line"># 1m =&gt;  1000000 bytes</span><br><span class="line"># 1mb =&gt; 1024*1024 bytes</span><br><span class="line"># 1g =&gt;  1000000000 bytes</span><br><span class="line"># 1gb =&gt; 1024*1024*1024 bytes</span><br><span class="line">#</span><br><span class="line"># 单位为大小写不敏感的，所以 1GB 1Gb 1gB表示同一意思.</span><br><span class="line">################################## INCLUDES ###################################</span><br><span class="line"></span><br><span class="line"># 在这里包含一个或者多个其他配置文件.  如果你有一个对于所有redis服务的标准配置模板，但</span><br><span class="line"># 也需要为某些服务作特殊订制时，这非常有用，示例如下：</span><br><span class="line">#</span><br><span class="line"># include /path/to/local.conf</span><br><span class="line"># include /path/to/other.conf</span><br><span class="line"></span><br><span class="line">################################## NETWORK #####################################</span><br><span class="line"># By default, if no &quot;bind&quot; configuration directive is specified, Redis listens</span><br><span class="line"># for connections from all the network interfaces available on the server.</span><br><span class="line">#默认情况下，如果没有声明bind指令，Redis会监听服务器上所有可用的网络接口（网卡）上的连接。</span><br><span class="line"># It is possible to listen to just one or multiple selected interfaces using</span><br><span class="line"># the &quot;bind&quot; configuration directive, followed by one or more IP addresses.</span><br><span class="line">#可以用bind指令指定Redis监听的一个或多个网络接口（网卡），示例如下：</span><br><span class="line">#</span><br><span class="line"># Examples:</span><br><span class="line"># bind 192.168.10.3 192.160.10.4 127.0.0.1</span><br><span class="line"># bind 127.0.0.1 ::1</span><br><span class="line">#如果你的Redis部署在公网上，并且监听所有网络接口（网卡），那么你的Redis示例便暴露给了互联网上的每个人，这样是很危险的。</span><br><span class="line"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"># 意思是说 bind 指定是Redis所在服务器网卡的ip，不是指定某些IP可以访问本机Redis实例</span><br><span class="line"># 如果你的bind指定的不是本机网卡IP，那么可能导致你的Redis实例无法启动</span><br><span class="line"># 这里很多人会误以为绑定的ip应该是请求来源的ip。其实不然，这里应该绑定的是你redis服务器本身接受请求的ip。</span><br><span class="line">bind &lt;ip&gt;</span><br><span class="line"></span><br><span class="line"># 默认保护模式是yes,只能127.0.0.1访问</span><br><span class="line"># 生产环境改成no</span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line"># 在此处指定接收连接的端口号，默认为6379，如果指定端口号为0，Redis不监听TCP socket</span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"># 此参数确定TCP连接中已完成队列（3次握手之后）的长度，应小于Linux系统的/proc/sys/net/core/somaxconn的值，此选项默认值为511，而linux的somaxconn默认值为128，当并发量比较大且客户端反应缓慢的时候，可以同时提高这两个参数。 </span><br><span class="line"># TCP listen() 储备.</span><br><span class="line">#</span><br><span class="line"># 在高并发的环境中，你需要有高的储备以避免客户端连接变慢的问题。</span><br><span class="line"># 注：Linux kernel内核将会截取此值赋值给/proc/sys/net/core/somaxconn以确保增加somaxconn和</span><br><span class="line"># tcp_max_syn_backlog的值以达到预期的效率</span><br><span class="line">tcp-backlog 511</span><br><span class="line"></span><br><span class="line"># 指定Unix socket的路径，用于监听进入的连接。没有默认值，所以不指定的话，Redis不监听Unix socket</span><br><span class="line"># unixsocket /tmp/redis.sock</span><br><span class="line"># unixsocketperm 700</span><br><span class="line"></span><br><span class="line"># 设置客户端连接时的超时时间，单位为秒。当客户端在这段时间内没有发出任何指令,那么关闭该连接,0代表禁用,默认是0</span><br><span class="line">timeout 300</span><br><span class="line"></span><br><span class="line"># TCP keepalive.</span><br><span class="line"># 如果不是0，使用SO_KEEPALIVE发送TCP ACKs（响应包）给没有交流的客户端。此配置对两点很有用：</span><br><span class="line"># 1）检查已掉线客户端</span><br><span class="line"># 2）从网络设备的角度考虑中间活着的连接</span><br><span class="line"># 指定ACKs的时间周期，单位为秒，值非0的情况表示将周期性的检测客户端是否可用，默认值为300</span><br><span class="line"># 在Linux系统上，指定的值是用于发送ACKs的周期（以秒为单位）。注：关闭连接需要又倍的时间。</span><br><span class="line"># 此处推荐的合理值为60秒。</span><br><span class="line">tcp-keepalive 60</span><br><span class="line"></span><br><span class="line">################################ GENERAL  #####################################</span><br><span class="line"></span><br><span class="line"># 默认情况下，Redis不以后台程序运行，如果需要，将‘no’改为‘yes’.</span><br><span class="line"># 注：当Redis以后台程序方式运行时，默认会在/var/run/目录下创建一个名称为redis.pid的进程ID文件</span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"># 可以通过upstart和systemd管理Redis守护进程，这个参数是和具体的操作系统相关的</span><br><span class="line">supervised no</span><br><span class="line"></span><br><span class="line"># 当以后台程序方式运行时，在此处指定指定进程ID文件路径与名称。</span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line"># 指定服务器的级别，可以由以下几个值：</span><br><span class="line"># 1)debug:大量的信息，易于开发与测试</span><br><span class="line"># 2)verbose:许多有用的信息，但不像debug级别那么一团糟。</span><br><span class="line"># 3)notice:适度详细的信息，可用于生产环境。</span><br><span class="line"># 4)warning:仅仅重要的或者错误性的的信息才会记录。</span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line"># 指定记录日志文件名称，也可以使用空字符串来强制Redis将日志输出到标准输出。</span><br><span class="line"># 注：如果是Redis是后台运行，如果是标准输出，将输出到/dev/null</span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line"># 要启用系统记录器记录日志，仅需设置&apos;syslog-enabled&apos;为yes，或者更新其他系统日志参数来满足需求</span><br><span class="line"># syslog-enabled no</span><br><span class="line"></span><br><span class="line"># 指定系统日志身份</span><br><span class="line"># syslog-ident redis</span><br><span class="line"></span><br><span class="line"># 指定系统日志设备，必须是USER或者LOCAL0到LOCAL7之间</span><br><span class="line"># syslog-facility local0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 设置数据库的数目。默认的数据库是DB 0 ，可以在每个连接上使用select  &lt;dbid&gt; 命令选择一个不同的数据库，dbid是一个介于0到databases - 1 之间的数值</span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">################################ SNAPSHOTTING  ################################</span><br><span class="line"></span><br><span class="line"># 保存数据到硬盘，格式：save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line"># 表示在seconds秒后如果有changes个key改变那么就保存到硬盘</span><br><span class="line"># 注：如果要完全禁用此保存功能，可以将所以save指令注释掉或者全部删除后新加： save &quot;&quot;。</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line"># 默认情况下，如果RDB快照功能被启用或者最后的后台保存失败，Redis将停止接收写操作请求。</span><br><span class="line"># 这会使用户觉察到（很难的）数据没有正确的持外化到磁盘上，否则风险将没人注意，一些灾难也可能会发生。</span><br><span class="line"># </span><br><span class="line"># 如果后台保存进程再次开始工作，Redis也会自动允许写操作请求。</span><br><span class="line"># </span><br><span class="line"># 但是，如果已经设置好了Redis服务器和持处化的监控，你可能想要禁用此功能，这样即使由于磁盘原因、权限问题</span><br><span class="line"># 等等原因，Redis也能继续像往常一样工作</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line"># 是否在备份.rdb数据库时使用LZF压缩字符串对象。</span><br><span class="line"># 默认情况下此值设为yes，因为这样设置几乎总是对的。</span><br><span class="line"># 如果你想要节省一些CPU资源，在从节点子节点中将它设置为no，那么如果你有需要压缩的keys或者values，</span><br><span class="line"># 数据集变得更大。</span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line"># 从RDB版本5开始，文件最后放置一个CRC64校验和。这使得此格式具有更大的抗性（安全），但当保存和加载RDB文</span><br><span class="line"># 件时有点性能损耗（大约10%），所以你可以禁用此指令以得到更好的性能。</span><br><span class="line"># </span><br><span class="line"># 如果禁用此指令，RDB文件中校验和为0，以此告知加载代码跳过此检查。</span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line"># rdb文件的名字</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"># 数据库存放目录。必须是一个目录，aof文件也会保存到该目录下</span><br><span class="line">dir /usr/local/redis-cluster/6379/data/</span><br><span class="line"></span><br><span class="line">################################# REPLICATION #################################</span><br><span class="line"></span><br><span class="line"># Master-Slave replication. Use slaveof to make a Redis instance a copy of</span><br><span class="line"># another Redis server. A few things to understand ASAP about Redis replication.</span><br><span class="line"># 主从复制，使用slaveof设置本地服务为其他服务副本。一些理解Redis副本ASAP的东东：</span><br><span class="line"># 1）Redis副本是异步的，但是如果连接的副本数量少于指定的数字，可以配置主服务拒绝接收写操作请求。</span><br><span class="line"># 2）如果Redis副本链接丢失相对一小段时间，Redis从服务能够执行部分的再次同步操作。</span><br><span class="line"># 3）副本是自动的并且不受用户干涉的。</span><br><span class="line"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line"></span><br><span class="line"># 如果主服务处理密码保护状态（在下边使用requirepass指令），它会告诉从服务在开启同步复制进程前</span><br><span class="line"># 进行认证，否则主服务拒绝从服务请求</span><br><span class="line"># 搭建集群时不要设置密码</span><br><span class="line"># masterauth &lt;master-password&gt;</span><br><span class="line"></span><br><span class="line"># 当从服务与主服务连接断开，或者当复制仍在进行中，副本应对客户端有两种方式：</span><br><span class="line"># 1) 如果slave-serve-stale-data被设为yes（默认的），从服务会继续响应客户端请求，可能会给出</span><br><span class="line">#    过时数据，或者如果是第一次同步则返回空的结果集</span><br><span class="line">#</span><br><span class="line"># 2) 如果slave-serve-stale-data被设为no，从服务会返回一个这样的错误“SYNC with master in </span><br><span class="line">#    progress”给所有的命令。</span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line"></span><br><span class="line"># 你可以配置一个从服务实例是否可以接收写操作请求。在从服务实例上进行写操作对于存储某些临时数据非常有用</span><br><span class="line">#（因为在从服务上进行写操作在与主服务同步后非常容易探查），但是也可能由于配置错误在客户端向从服务写数据</span><br><span class="line"># 时造成一些问题，从Redis2.6开始，默认从服务是只读的。</span><br><span class="line">#</span><br><span class="line"># 注：只读从服务用于暴露给互联网上不可信客户端。是对监用服务实例的保护层。默认情况下只读从服务仍然会输出</span><br><span class="line"># 默认命令如ONFIG、DEBIG等等。你可以通过使用‘rename-command’隐藏所有管理员或者是危险的命令的方法一定限</span><br><span class="line"># 度内提高只读从服务的安全性。</span><br><span class="line">slave-read-only yes</span><br><span class="line"></span><br><span class="line"># 同步复制策略：磁盘或者socket</span><br><span class="line"># -------------------------------------------------------</span><br><span class="line"># 警告: 无磁盘复制现在处于试验阶段</span><br><span class="line"># -------------------------------------------------------</span><br><span class="line"># 新建的从服务或者重新接从服务（不能够继续复制进程，而只接收差异）需要做一个叫做“full </span><br><span class="line"># synchronization”的操作。一个RDB文件由主服务传送到从服务，传送过程可能发生两种情况：</span><br><span class="line">#</span><br><span class="line"># 1）Disk-backed： Redis主服务创建一个新的进程将RDB文件写到磁盘上。随后由其父进程遂渐迁移RDB文件到从</span><br><span class="line">#                 服务。</span><br><span class="line"># 2) Diskless: Redis主服务创建一个新进程直接将RDB文件写给从服务的socket，不在操作磁盘。</span><br><span class="line">#</span><br><span class="line"># 对于disk-backed式复制，当RDB文件被生成后，所有从服务排队等到新建子进程（将RDB写到磁盘上）完成其工作</span><br><span class="line"># 立即被服务。对于diskless式复制，一次迁移开始，新连接的从服务排队，现在迁移终结马上创建一个新的迁移。</span><br><span class="line"># </span><br><span class="line"># diskless式复制被使用时，master主服务会在启动迁移之前等待一段可指定的时间（单位是秒），以期望更多的</span><br><span class="line"># 从服务连接并且并行的迁移。</span><br><span class="line"># 在低速硬盘，高速网络情况下，Diskless式复制性能更好</span><br><span class="line">repl-diskless-sync no</span><br><span class="line"></span><br><span class="line"># 当diskless式复制启用，可以配置服务器延迟开始迁移的时间。</span><br><span class="line"># </span><br><span class="line"># 之所以有此配置，是因为一理迁移开始，新到达的连接就只能排队等下次迁移，所以服务器等待一段时间以期更多的</span><br><span class="line"># 从服务连接到达。此配置以秒为单位指定，默认是5秒，设为0则表示禁用此项功能。</span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line"></span><br><span class="line"># 配置从服务发送PINGs到到主服务器预定义的时间间隔，默认是10秒。</span><br><span class="line"># repl-ping-slave-period 10</span><br><span class="line"></span><br><span class="line"># The following option sets the replication timeout for:</span><br><span class="line"># 下面选项是设置复制超时，所针对对象为：</span><br><span class="line"># 1）同步期间，批量I/O传输超时。</span><br><span class="line"># 2）master主服务超时。</span><br><span class="line"># 3）Slave从服务器超时</span><br><span class="line"># 将此处配置的值比repl-ping-slave-period指定的值大是非常有必要的。.</span><br><span class="line"># 当redis检测到repl-timeout超时(默认值60s)，将会关闭主从之间的连接,redis slave发起重新建立主从连接的请求。对于内存数据集比较大的系统，可以增大repl-timeout参数。 </span><br><span class="line"># repl-timeout 60</span><br><span class="line"></span><br><span class="line"># 同步之后是否禁用slave的socket的TCP_NODELAY。</span><br><span class="line"># </span><br><span class="line"># 如果设为yes，redis主服务器将以更小数量的TCP packets和更少带宽来发送数据到slave从服务。</span><br><span class="line"># 如果设为no，数据出现在slave处的延迟将会减少，但是更多的带宽将用于复制。</span><br><span class="line"># 默认情况下，我们选择低延迟，但是如果在高流量的条件或者master主服务与slave从服务之们有许多路由相隔，设置为yes会更好一点。</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"></span><br><span class="line"># 设置复制储备大小。复制储备是一个缓冲器，用来存放某些时候slaves与master断开连接时slave的数据，这样当</span><br><span class="line"># 一个slave重新连接到master时，就不需要一个全部的再次同步，只需要一个部分的再同步（仅传送slave断开连接</span><br><span class="line"># 后丢失的数据）即可。</span><br><span class="line"># 默认1mb</span><br><span class="line"># 会出现问题,参考如下</span><br><span class="line"># https://github.com/antirez/redis/issues/1400</span><br><span class="line"># http://zhmgz.lofter.com/post/90909_bbabd6b</span><br><span class="line">repl-backlog-size 512mb</span><br><span class="line"></span><br><span class="line"># 在master主服务与slave从服务断开连接后一段时间，复制储备（replication backlog）将会被释放。</span><br><span class="line"># 此处即为设置断开连接后多久复制储备被释放，如果为0，则永不释放。</span><br><span class="line">repl-backlog-ttl 0</span><br><span class="line"></span><br><span class="line"># 设置slave服务的优先级，可用于当master服务出现问题时选现此值设置最低的slave做为master,如果此值设为</span><br><span class="line"># 0，表示此slave服务永远不可能成为master服务，默认为100。</span><br><span class="line">slave-priority 100</span><br><span class="line"></span><br><span class="line"># 如果master连接的slave少于3个，master可以停止接收写操作请求，最多可延迟10秒后停止。</span><br><span class="line"># 设置为0表示禁用此项功能。</span><br><span class="line"># min-slaves-to-write 3</span><br><span class="line"># min-slaves-max-lag 10</span><br><span class="line"></span><br><span class="line"># Slave 配置中指定的 Master 结点 IP 是关键所在。</span><br><span class="line"># Slave 建立到 Master 的 TCP 连接时，Master 获取到的对端 IP 和 PORT 标识该 Slave，在 Master 的 INFO 命令中体现。</span><br><span class="line"># Slave 连接的 Master IP，经由路由规则，也就决定了 Master 看到的是 Slave 的哪一个 IP。</span><br><span class="line"># slave-announce-ip 5.5.5.5</span><br><span class="line"># slave-announce-port 1234</span><br><span class="line"></span><br><span class="line">################################## SECURITY ###################################</span><br><span class="line"># 配置登录Redis服务密码。配置了此项，客户端需要先执行AUTH &lt;PASSWORD&gt;命令，然后才能执行其他命令。</span><br><span class="line"># requirepass foobared</span><br><span class="line"></span><br><span class="line"># 重命名命令名称</span><br><span class="line"># 在共享环境下可以改变一些危险命令的名字，以避免命令滥用造成的问题。如：</span><br><span class="line"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span><br><span class="line">#</span><br><span class="line"># 如果将命令重命名为空，则表示干掉此命令。</span><br><span class="line"># rename-command CONFIG &quot;&quot;</span><br><span class="line">rename-command FLUSHALL joYAPNXRPmcarcR4ZDgC81TbdkSmLAzRPmca</span><br><span class="line">rename-command FLUSHDB  qf69aZbLAX3cf3ednHM3SOlbpH71yEXLAX3c</span><br><span class="line">rename-command CONFIG   FRaqbC8wSA1XvpFVjCRGryWtIIZS2TRvpFVj</span><br><span class="line">rename-command KEYS     eIiGXix4A2DreBBsQwY6YHkidcDjoYA2DreB</span><br><span class="line"></span><br><span class="line">################################### LIMITS ####################################</span><br><span class="line"># 设置客户端最大并发连接数，默认无限制，Redis可以同时打开的客户端连接数为Redis进程可以打开的最大文件描述符数-32（redis server自身会使用一些），如果设置 maxclients 0，表示不作限制。当客户端连接数到达限制时，Redis会关闭新的连接并向客户端返回max number of clients reached错误信息。</span><br><span class="line"># maxclients 10000</span><br><span class="line"></span><br><span class="line">#指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key，当此方法处理 后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区，格式：maxmemory &lt;bytes&gt;</span><br><span class="line"># 大约40GB　</span><br><span class="line">maxmemory 40000000000</span><br><span class="line"></span><br><span class="line"># 最大内存策略：即当达到最大内存时Redis的行为：</span><br><span class="line"># 1）volatile-lru：驱逐keys，尝试优先删除最近使用的最少的keys，但只在已过期的keys中删除。</span><br><span class="line"># 2）allkeys-lru：驱逐keys，尝试优先删除最近使用的最少的keys。</span><br><span class="line"># 3）volatile-random：随机驱逐keys以便给新添数据腾地方，但仅在已过期keys中随机驱逐。</span><br><span class="line"># 4）allkeys-random：随机驱逐keys以便给新添数据腾地方。</span><br><span class="line"># 5）volatile-ttl：为了给新增数据腾地方，驱逐已过期的keys，和试图优先驱逐最短生存时间keys。</span><br><span class="line"># 6）noeviction：不删除内存中key，只是返回一个写操作错误。</span><br><span class="line"># 注：对于前五种策略，当内存中不存在可以删除的key时都会报一个写操作错误。</span><br><span class="line">maxmemory-policy allkeys-lru</span><br><span class="line"></span><br><span class="line"># LRU算法与最小TTL算法是近似的算法（用于节约内存）而非精确的算法，所以可以调节他的速度与精确度。</span><br><span class="line"># 如Redis默认的maxmemory-samples为5，即Redis随机检查5个Keys，取出一个近期使用最少的。</span><br><span class="line"># 默认的5工作不错，如果指定为10，精确度LRU算法，但是花销的CPU资源有点多，如果指定为3则非常快但是</span><br><span class="line"># 精确度不够。以下为配置指令：</span><br><span class="line"># maxmemory-samples 5</span><br><span class="line"></span><br><span class="line">############################## APPEND ONLY MODE ###############################</span><br><span class="line"></span><br><span class="line"># 默认情况下，Reids异步的将数据集备份到磁盘。这种模式对于大多数应用程序都够使了，但是如果</span><br><span class="line"># Redis进程问题或者断电事帮可能会导致少量写操作丢失（依据配置的保存点而定）。</span><br><span class="line"># Append Only File（AOF）是Redis提供的另一种持久化模式。例如使用默信的数据fsync策略（稍后在配置文件中</span><br><span class="line"># 看），</span><br><span class="line"># 在像断电或者Redis进程自身发生的的某个写操作出错这样的事故中Redis可以只丢失1秒的写操作，并且系统还可</span><br><span class="line"># 以正确的运行。AOF和RDB持久化可以同时启用。如果AOF机制启用，Redis启用时将加载AOF文件，AOF文件可提供 </span><br><span class="line"># 更耐久的保证。更多持久化信息：http://redis.io/topics/persistence</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"># 配置AOF文件名称：</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"></span><br><span class="line"># 调用fsync()函数就是告诉操作系统直接将数据写到磁盘，而不等待输出缓冲区中的更多数据。有些操作系统将数</span><br><span class="line"># 数据刷新到磁盘，有的则仅仅尝试尽快将数据刷新到磁盘。Redis支持三种机制：</span><br><span class="line"># 1）no：不调用fsync，仅仅让操作系统自己决定什么时候刷新数据到磁盘，最快。</span><br><span class="line"># 2）always：第次写操作后都调用fsync，慢，但最安全。</span><br><span class="line"># 3）everysec：每秒调用fsync一次，上面两者的妥协。为默认值。</span><br><span class="line"># 更多细节请访问：http://antirez.com/post/redis-persistence-demystified.html</span><br><span class="line">appendfsync everysec</span><br><span class="line"></span><br><span class="line"># 当AOF fsync策略被设置为always或者everysec，并且一个后台保存进程（一个后台保存或者AOF日志后台重写）</span><br><span class="line"># 正执行许多磁盘I/O时，在一些Linux配置中，Redis在调用fsync()函数上将后阻塞太久。注，现在这个问题</span><br><span class="line"># 还没有修复，因为即使使用不同线程异步执行fsync，但是同步写操作掉用时仍会阻塞。</span><br><span class="line">#</span><br><span class="line"># 为了减轻此问题，可以使用以下配置选项来阻止当BGSAVE或者BGREWRITEAOF运行时在主进程中调用fsync.</span><br><span class="line"># 也就是当子进程正进行保存操作时，Redis的持久化跟设置appendfsync为no时一样。如果考虑延迟问题</span><br><span class="line"># ，可以将此配置选项设为yes，否则保留为no，因为从持久化角度看，设为no更安全。</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line"># 自动重写AOF文件，redis能够在当AOF日志文件大小以指定百分比增长时通过调用BGREWRITEAOF隐式</span><br><span class="line"># 重写日志文件。</span><br><span class="line"># Redis记录AOF文件最后重写后的大小，如果从启动后就没有重写，则记录启动时使用的大小，即原大小，</span><br><span class="line"># AOF现在AOF文件大小与原大小相比，如果百分比大于指定的百分比，那么就会触发重写操作。同样的，你需要</span><br><span class="line"># 指定一个AOF文件需要重写的最小值，这可以避免当文件很小时重写操作，即使文件的大小增长达到了指定百分比。</span><br><span class="line"># 如果指定百分比为0，表示禁用重写AOF功能。</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"></span><br><span class="line"># 进行后面rewrite要求的最小AOF文件大小。这两个选项共同决定了后面rewrite进程是否到达运行的时机</span><br><span class="line"># 注：rewrite是指当AOF很大的时候，通过重写内存的数据来删除原来的AOF文件，生成最新的内存数据的AOF日志，即把当前的结果逆转化为相应的操作命令写到AOF文件中。</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line"># AOF写入时，可能存在指令写错问题，如操作系统宕机（redis自身崩溃则不会），当此种情况发生时</span><br><span class="line"># redis要么报错退出，要么忽略掉错误的指令尽量恢复更多的数据（默认的）。</span><br><span class="line"># 如果设置为no，即非默认，遇到AOF中有指令错误就直接报错退出，此时用户需要用redis-check-aof</span><br><span class="line"># 工具修复AOF文件。</span><br><span class="line"># 以上均为AOF文件尾部出错的情况，如晨AOF文件中间出现错误，Redis同样会报错退出。这种情况只会出现</span><br><span class="line"># 在当Redis试图从AOF文件中加载许多数据时没有足够的内存的场景。</span><br><span class="line"># 自动修复机制</span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line">################################ LUA SCRIPTING  ###############################</span><br><span class="line"></span><br><span class="line"># 设置一个LUA脚本的最大执行时间，单位是毫秒。</span><br><span class="line"># 如果执行时间超过最大执行时间，Redis将记录此超时后仍在执行的脚本并且开始响应一个错误回复。</span><br><span class="line"># 当一个执行中的脚本执行时间超过了最大执行时间，可以使用SCRIPT KILL和SHUTDOWN NOSAVE命令。</span><br><span class="line"># 第一个命令可用于停止还没有调用写操作命令的脚本运行。第二个则是当写操作命令已被调用，但是用户</span><br><span class="line"># 不想脚本正常执行完成时关闭服务。</span><br><span class="line"># 如果设置为0则表示不限制脚本执行时间。</span><br><span class="line">lua-time-limit 5000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">################################ REDIS CLUSTER  ###############################</span><br><span class="line">#</span><br><span class="line"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line"># 体验警告：Redis机群可以认为是稳定的，但是为了使它更成熟，我们需要等待将它发布到生产环境的</span><br><span class="line"># 用户的反馈。</span><br><span class="line"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line"># 正常的Redis实例是不能成为Redis集群的一部分的，只有那些作为集群节点的节点才可以。为了以集群</span><br><span class="line"># 节点方式启动redis服务，可以如下配置：</span><br><span class="line">cluster-enabled yes</span><br><span class="line"></span><br><span class="line"># 每个集群节点都有一个集群配置文件，它由Redis节点创建和修改，而不希望手动修改。</span><br><span class="line"># 每个Redis集群节点需要一个不同的集群配置文件。要确保集群中所有实例运行在相同系统中，并且不能有</span><br><span class="line"># 重名的配置文件，下面是配置本节点配置文件</span><br><span class="line">cluster-config-file nodes-6379.conf</span><br><span class="line"></span><br><span class="line"># 设置集群节点超时时间，以毫秒为单</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line"></span><br><span class="line"># 一个master挂掉时要避免数据太老的slave成为master。</span><br><span class="line"># 对于一个slave从服务来说，没有一个简单方式来确切衡量数据的新旧，所以下面两个检查需要执行：</span><br><span class="line"># 1）如果有多个可以做为灾备的slave从服务，它们会交换信息以从复制偏移量（从主服务获取数据</span><br><span class="line">#    的多少）为标准来进行一个排位。这此从服务通过偏移量获取自己的排名，此排名与它们成为灾备</span><br><span class="line">#    的延迟是成比例的。</span><br><span class="line"># 2）单个slave服务计算最后同master主服务交互的时间。如果master还健在，可以是最后的ping或者</span><br><span class="line">#    是最后接收到的命令，或者如果复制链已失效，可以是从与master断开连接后开始到计算时已经过</span><br><span class="line">#    的时间，也叫逃逸时间。</span><br><span class="line"># 上面第二点是可以被用户调整的。尤其是如果一个slave的逃逸时间大于：</span><br><span class="line">#   (node-timeout * slave-validity-factor) + repl-ping-slave-period</span><br><span class="line">#   10 * 15 +10 = 160秒 如果超过160秒不让slave成为灾备</span><br><span class="line"># 那么此slave是不可以做为灾备执行。</span><br><span class="line"># </span><br><span class="line"># slave-validity-factor值设置的过大则可能出现数据太老的slave成为灾备，太小则可能选不出</span><br><span class="line"># 可作为灾备的slave。</span><br><span class="line">cluster-slave-validity-factor 10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Redis集群slave能够迁移孤立的masters（没有工作的slave节点）上。</span><br><span class="line"># 只有当slave的老master最少还有可工作的指定数量的slaves，此slave才可以迁移，而指</span><br><span class="line"># 定的数目称为迁移障碍（migration barrier），默认为1，如果要禁用迁移则可以设置一个非常大的值</span><br><span class="line"># ，设为0一般用于调试，设置方法如下：</span><br><span class="line"># cluster-migration-barrier 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 默认情况下，如果redis集群检测到至少一个哈希槽未被覆盖，redis节点就会停止接收查询请求。</span><br><span class="line"># 这种情况，如果集群部分不好使了，那么集群的所有节点也会慢慢的变为不可用。但是，有时候你可能</span><br><span class="line"># 想要没坏的节点继续接收查询请求，要达到此目的，可以将下面指令配置为no：</span><br><span class="line">cluster-require-full-coverage no</span><br><span class="line"></span><br><span class="line">################################## SLOW LOG ###################################</span><br><span class="line"></span><br><span class="line"># Redis Slow Log是用于记录超过指定执行时间的查询操作的系统。指定的执行时间是不包含执行I/O</span><br><span class="line"># 操作的时间，而是真正执行命令的时间。有两个参数用于配置slow log，一个告诉Redis执行时间是多少</span><br><span class="line"># 以微秒为单位；另一个参数是slow log的长度。当有新的命令被记录，记录命令队列里的老命令就会被删除。</span><br><span class="line"># 配置指定时间为0.01秒如下：</span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line"></span><br><span class="line"># 设置slow log的长度，此长度没限制，但需考虑内存消耗。</span><br><span class="line">slowlog-max-len 128</span><br><span class="line"></span><br><span class="line">################################ LATENCY MONITOR ##############################</span><br><span class="line"></span><br><span class="line"># Redis延迟监控子系统取样运行中不同操作以收集可能造成Redis实例延迟的数据。</span><br><span class="line"># 此系统仅记录等于或者大于latency-monitor-threshold指令配置的以毫秒为单位的时间执行的操作，</span><br><span class="line"># 如果配置为0，表示关闭延迟监控。</span><br><span class="line"># 默认情况下，延迟监控是被禁用的，因为如果你没有延迟问题几乎不需要，并且收集数据是有性能影响的，</span><br><span class="line"># 尽管很小，但加载量大的时候也可衡量。</span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line"></span><br><span class="line">############################# EVENT NOTIFICATION ##############################</span><br><span class="line"></span><br><span class="line"># Redis可以通知Pub/sub客户端关于key空间发生的事件。关于此功能的文档地址：</span><br><span class="line"># http://redis.io/topics/notifications</span><br><span class="line"># 例如：如果key空间事件通知是启用的，并且一个客户端在数据库0的key “foo”上执行了一个删除操作，</span><br><span class="line"># 将通过Pub/Sub发布两条信息：</span><br><span class="line"># 1）PUBLISH __keyspace@0__:foo del</span><br><span class="line"># 2）PUBLISH __keyevent@0__:del foo</span><br><span class="line"># 以下为配置，如果为空，则表示禁用。</span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">############################## ADVANCED CONFIG ###############################</span><br><span class="line"></span><br><span class="line"># Hashes，当它们只是小数量的实体和最大实体不超过一个给定阀值时，使用一种内存高效数据结构</span><br><span class="line"># 编码。实体数量与实体大小阀值可如下配置：</span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"># 同hashes类似，lists内一定数量内的实体且list大小不超过一定值时同样会以一种特别的方式编码，以节省大量</span><br><span class="line"># 空间。配置其限制如下：</span><br><span class="line">list-max-ziplist-entries 512</span><br><span class="line">list-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"># sets集合仅在一种情况下会用特殊方式编码：当set是由64位以内的有符号的10进制整数的字符串组成时。</span><br><span class="line"># 以下为配置set内实体数量的限制：</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line"></span><br><span class="line"># 配置Sorted-set</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"># 配置HyperLogLog稀疏表示字节限制：</span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line"></span><br><span class="line"># 指定是否激活重hash</span><br><span class="line">activerehashing yes</span><br><span class="line"></span><br><span class="line"># 客户端缓冲区限制可用于强制那些因为某些原因从服务器读取数据不够快的客户端断开连接（如一个</span><br><span class="line"># Pub/Sub客户端消费消息的速度比不上发布者发布的速度）。</span><br><span class="line"># The limit can be set differently for the three different classes of clients:</span><br><span class="line"># 此限制可以针对三种不同类型客户端设置不同：</span><br><span class="line"># 1）normal -&gt; 正常客户端包括监控客户端</span><br><span class="line"># 2）slave  -&gt; slave客户端</span><br><span class="line"># 3）pubsub -&gt; 订阅客户端</span><br><span class="line">#</span><br><span class="line"># 针对客户端的配置客户端缓冲区限制指令语法如下（以&lt;class&gt;表示不同类型客户端）：</span><br><span class="line"># client-output-buffer-limit &lt;class&gt; &lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt;</span><br><span class="line">#</span><br><span class="line"># 一旦&lt;hard limit&gt;限制达到或者持续达到&lt;soft limit&gt;指定数目秒数时间（&lt;soft seconds&gt;）时会</span><br><span class="line"># 被立即断开连接。</span><br><span class="line"># 默认情况下，normal客户端不会被限制，因为它们不请求就不会接收数据。</span><br><span class="line"># 设置&lt;hard limit&gt;和&lt;soft limit&gt;都可禁用此功能。</span><br><span class="line"># http://zhmgz.lofter.com/post/90909_bbabd6b</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit slave  0 0 0</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line"></span><br><span class="line"># Redis调用内部部函数来执行许多的后台任务，就像关闭超时的客户端连接，驱逐从不被请求的已过期的keys等等。</span><br><span class="line"># 并不是所有的任务都是以相同的频率执行，但是redis通过指定的“hz”的值检查执行的任务。</span><br><span class="line"># 默认情况下，hz被设置为10。加大此值会在redis空间的时候消耗许多CPU资源，但是，当有许多</span><br><span class="line"># keys同时过期时，同进也会让redis反应更灵敏，超时处理的更精度。</span><br><span class="line"># hz值的设置范围是1~500，但是超过100通常不太好。建议使用默认值，除非对延迟有较高要求时可以</span><br><span class="line"># 增加到上限100。</span><br><span class="line">hz 10</span><br><span class="line"></span><br><span class="line"># 当一个子操作重写AOF文件时，如果下面选项启用，那么每32MB的数据生成就会调用fsync()。</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br></pre></td></tr></table></figure>
<h3 id="Sentinel完整配置文件"><a href="#Sentinel完整配置文件" class="headerlink" title="Sentinel完整配置文件"></a>Sentinel完整配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"># Example sentinel.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 保护模式,默认开启,只能够使用127.0.0.1 192.168.1.1访问,一般要关闭</span><br><span class="line">protected-mode yes</span><br><span class="line"></span><br><span class="line"># 启动端口,默认26379</span><br><span class="line">port 26379</span><br><span class="line"></span><br><span class="line"># 后台启动,默认关闭,开启之后将会在生成一个/var/run/redis-sentinel.pid文件,一般开启</span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"># pid文件位置，默认输出到/var/run/redis-sentinel.pid,了呀自定义</span><br><span class="line">pidfile /var/run/redis-sentinel.pid</span><br><span class="line"></span><br><span class="line"># 指定记录日志文件名称，也可以使用空字符串来强制sentinel将日志输出到标准输出。</span><br><span class="line"># 注：如果是sentinel是后台运行，如果是标准输出，将输出到/dev/null</span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line"># 指定特殊的地址访问</span><br><span class="line"># sentinel announce-ip &lt;ip&gt;</span><br><span class="line"># sentinel announce-port &lt;port&gt;</span><br><span class="line">#</span><br><span class="line"># The above two configuration directives are useful in environments where,</span><br><span class="line"># because of NAT, Sentinel is reachable from outside via a non-local address.</span><br><span class="line">#</span><br><span class="line"># When announce-ip is provided, the Sentinel will claim the specified IP address</span><br><span class="line"># in HELLO messages used to gossip its presence, instead of auto-detecting the</span><br><span class="line"># local address as it usually does.</span><br><span class="line">#</span><br><span class="line"># Similarly when announce-port is provided and is valid and non-zero, Sentinel</span><br><span class="line"># will announce the specified TCP port.</span><br><span class="line">#</span><br><span class="line"># The two options don&apos;t need to be used together, if only announce-ip is</span><br><span class="line"># provided, the Sentinel will announce the specified IP and the server port</span><br><span class="line"># as specified by the &quot;port&quot; option. If only announce-port is provided, the</span><br><span class="line"># Sentinel will announce the auto-detected local IP and the specified port.</span><br><span class="line">#</span><br><span class="line"># Example:</span><br><span class="line">#</span><br><span class="line"># sentinel announce-ip 1.2.3.4</span><br><span class="line"></span><br><span class="line"># 工作线程的工作目录，默认在/tmp目录下,可自定义</span><br><span class="line">dir /tmp</span><br><span class="line"></span><br><span class="line"># Note: master name should not include special characters or spaces.</span><br><span class="line"># The valid charset is A-z 0-9 and the three characters &quot;.-_&quot;.</span><br><span class="line"># 告诉sentinel去监听地址为ip:port的一个master，这里的master-name可以自定义，quorum是一个数字，指明当有多少个sentinel认为一个master失效时，master才算真正失效。master-name只能包含英文字母，数字，和“.-_”这三个字符需要注意的是master-ip 要写真实的ip地址而不要用回环地址（127.0.0.1）。</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 2</span><br><span class="line"></span><br><span class="line"># 设置连接master和slave时的密码，注意的是sentinel不能分别为master和slave设置不同的密码，因此master和slave的密码应该设置相同。默认关闭,生产环境一般会开启</span><br><span class="line">sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span><br><span class="line"></span><br><span class="line"># 这个配置项指定了需要多少失效时间，一个master才会被这个sentinel主观地认为是不可用的。 单位是毫秒，默认为30秒</span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"></span><br><span class="line"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，这个数字越小，完成failover所需的时间就越长，但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。默认1</span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"></span><br><span class="line"># failover-timeout 可以用在以下这些方面： </span><br><span class="line">#      1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span><br><span class="line">#      2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span><br><span class="line">#      3.当想要取消一个正在进行的failover所需要的时间。  </span><br><span class="line">#      4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了。</span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"></span><br><span class="line"># 哨兵提醒脚本,用来给管理人员提供一些提醒的脚本</span><br><span class="line"># SCRIPTS EXECUTION</span><br><span class="line">#</span><br><span class="line"># sentinel notification-script and sentinel reconfig-script are used in order</span><br><span class="line"># to configure scripts that are called to notify the system administrator</span><br><span class="line"># or to reconfigure clients after a failover. The scripts are executed</span><br><span class="line"># with the following rules for error handling:</span><br><span class="line">#</span><br><span class="line"># If script exits with &quot;1&quot; the execution is retried later (up to a maximum</span><br><span class="line"># number of times currently set to 10).</span><br><span class="line">#</span><br><span class="line"># If script exits with &quot;2&quot; (or an higher value) the script execution is</span><br><span class="line"># not retried.</span><br><span class="line">#</span><br><span class="line"># If script terminates because it receives a signal the behavior is the same</span><br><span class="line"># as exit code 1.</span><br><span class="line">#</span><br><span class="line"># A script has a maximum running time of 60 seconds. After this limit is</span><br><span class="line"># reached the script is terminated with a SIGKILL and the execution retried.</span><br><span class="line"></span><br><span class="line"># NOTIFICATION SCRIPT</span><br><span class="line"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span><br><span class="line"># </span><br><span class="line"># Call the specified notification script for any sentinel event that is</span><br><span class="line"># generated in the WARNING level (for instance -sdown, -odown, and so forth).</span><br><span class="line"># This script should notify the system administrator via email, SMS, or any</span><br><span class="line"># other messaging system, that there is something wrong with the monitored</span><br><span class="line"># Redis systems.</span><br><span class="line">#</span><br><span class="line"># The script is called with just two arguments: the first is the event type</span><br><span class="line"># and the second the event description.</span><br><span class="line">#</span><br><span class="line"># The script must exist and be executable in order for sentinel to start if</span><br><span class="line"># this option is provided.</span><br><span class="line">#</span><br><span class="line"># Example:</span><br><span class="line">#</span><br><span class="line"># sentinel notification-script mymaster /var/redis/notify.sh</span><br><span class="line"></span><br><span class="line"># CLIENTS RECONFIGURATION SCRIPT</span><br><span class="line">#</span><br><span class="line"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span><br><span class="line">#</span><br><span class="line"># When the master changed because of a failover a script can be called in</span><br><span class="line"># order to perform application-specific tasks to notify the clients that the</span><br><span class="line"># configuration has changed and the master is at a different address.</span><br><span class="line"># </span><br><span class="line"># The following arguments are passed to the script:</span><br><span class="line">#</span><br><span class="line"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span><br><span class="line">#</span><br><span class="line"># &lt;state&gt; is currently always &quot;failover&quot;</span><br><span class="line"># &lt;role&gt; is either &quot;leader&quot; or &quot;observer&quot;</span><br><span class="line"># </span><br><span class="line"># The arguments from-ip, from-port, to-ip, to-port are used to communicate</span><br><span class="line"># the old address of the master and the new address of the elected replica</span><br><span class="line"># (now a master).</span><br><span class="line">#</span><br><span class="line"># This script should be resistant to multiple invocations.</span><br><span class="line">#</span><br><span class="line"># Example:</span><br><span class="line"># sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span><br><span class="line"></span><br><span class="line"># SECURITY</span><br><span class="line">#</span><br><span class="line"># By default SENTINEL SET will not be able to change the notification-script</span><br><span class="line"># and client-reconfig-script at runtime. This avoids a trivial security issue</span><br><span class="line"># where clients can set the script to anything and trigger a failover in order</span><br><span class="line"># to get the program executed.</span><br><span class="line"># </span><br><span class="line">sentinel deny-scripts-reconfig yes</span><br><span class="line"></span><br><span class="line"># Redis命令重命名,比如你的CONFIG命令在redis那边重命名成GUESSME,在这边你也需要重命名成GUESSME，否则会导致选举失败。生产环境一般会重命名CONFIG命令。因此一般这里会开启。</span><br><span class="line">SENTINEL rename-command mymaster CONFIG GUESSME</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/20/生产机器搭建计划/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="铜豌豆6号">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/timg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张雨阳的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/20/生产机器搭建计划/" itemprop="url">生产机器搭建计划</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-20T20:15:00+08:00">
                2019-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/从小白到大白系列-中间件/" itemprop="url" rel="index">
                    <span itemprop="name">从小白到大白系列-中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/20/生产机器搭建计划/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/04/20/生产机器搭建计划/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/04/20/生产机器搭建计划/" class="leancloud_visitors" data-flag-title="生产机器搭建计划">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>由于公司近期需要架构升级，给到了三台新的机器。主要的目的是想解决一下我们之前项目中存在的一些问题。比如文件存储、缓存、消息队列这些问题。下面的几篇博客将记录我整个搭建的过程。后续还有一些用法的博客，我也是边学边弄。不足之处，欢迎一起探讨。</p>
<h2 id="服务器分配和基本配置"><a href="#服务器分配和基本配置" class="headerlink" title="服务器分配和基本配置"></a>服务器分配和基本配置</h2><div class="table-container">
<table>
<thead>
<tr>
<th>物理IP</th>
<th>CPU型号</th>
<th>CPU的个数</th>
<th>系统版本</th>
<th>内存</th>
</tr>
</thead>
<tbody>
<tr>
<td>xx.xxx.xxx.xx</td>
<td>Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHz</td>
<td>40</td>
<td>CentOS 7.2</td>
<td>128G</td>
</tr>
<tr>
<td>xx.xxx.xxx.xx</td>
<td>Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHz</td>
<td>40</td>
<td>CentOS 7.2</td>
<td>128G</td>
</tr>
<tr>
<td>xx.xxx.xxx.xx</td>
<td>Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHz</td>
<td>40</td>
<td>CentOS 7.2</td>
<td>128G</td>
</tr>
</tbody>
</table>
</div>
<h2 id="服务器部署方案"><a href="#服务器部署方案" class="headerlink" title="服务器部署方案"></a>服务器部署方案</h2><h3 id="技术方案选择"><a href="#技术方案选择" class="headerlink" title="技术方案选择"></a>技术方案选择</h3><h4 id="1-分布式协调-Zookeeper"><a href="#1-分布式协调-Zookeeper" class="headerlink" title="1. 分布式协调-Zookeeper"></a>1. 分布式协调-Zookeeper</h4><h5 id="1-1-Zookeeper的介绍"><a href="#1-1-Zookeeper的介绍" class="headerlink" title="1.1  Zookeeper的介绍"></a>1.1  Zookeeper的介绍</h5><p>Zookeeper是大数据生态圈中的重要组件,如果你做过相关开发的话,应该经常能看到它的身影。其由雅虎开源并成为Apache的顶级项目。用一句话对其进行定义就是: 它是一套高吞吐的分布式协调系统。从中我们可以知道Zookeeper至少具有以下特点：</p>
<ul>
<li><p>Zookeeper的主要作用是为分布式系统提供协调服务，包括但不限于: 分布式锁、统一命名服务、配置管理、负载均衡、主控服务器选举以及主从切换等。</p>
</li>
<li><p>Zookeeper自身通常也以分布式形式存在。一个Zookeeper服务通常由多台服务器节点构成,只要其中超过一半的节点存活,Zookeeper即可正常对外提供服务，所以Zookeeper也暗含高可用的特性。客户端可以通过TCP协议连接至任意一个服务端节点请求Zookeeper集群提供服务，而集群内部如何通信以及如何保持分布式数据一致性等细节对客户端透明。如下图所示:</p>
<p><img src="/2019/04/20/生产机器搭建计划/zk\1.png" alt></p>
</li>
<li><p>Zookeeper是以高吞吐量为目标进行设计的，故而在读多写少的场合有非常好的性能表现。如下图所示:</p>
<p><img src="/2019/04/20/生产机器搭建计划/zk\2.png" alt></p>
</li>
</ul>
<p>Zookeeper具有高吞吐特性的主要原因有以下几点:</p>
<ol>
<li><p>Zookeeper集群的任意一个服务端节点都可以直接响应客户端的读请求并且可以通过增加节点进行横向扩展。这是其吞吐量高的主要原因。</p>
</li>
<li><p>Zookeeper将全量数据存储于内存中，从内存中读取数据不需要进行磁盘IO，速度要快得多。</p>
</li>
<li><p>Zookeeper放松了对分布式数据的强一致性要求，即不保证数据实时一致，允许分布式数据经过一个时间窗口达到最终一致，这也在一定程度上提高了其吞吐量。</p>
</li>
</ol>
<p>而写请求，或者说事务请求，因为要进行不同服务器结点间状态的同步，一定程度上会影响其吞吐量。故而简单的增加Zookeeper的服务器节点数量,对其吞吐量的提升并不一定能起到正面效果。服务器节点增加，有利于提升读请求的吞吐量，但会延长服务器节点数据的同步时间，必须视具体情况在这两者之间取得一个平衡。</p>
<h5 id="1-2-为什么选择Zookeeper"><a href="#1-2-为什么选择Zookeeper" class="headerlink" title="1.2 为什么选择Zookeeper"></a>1.2 为什么选择Zookeeper</h5><h6 id="1-2-1-Master选举"><a href="#1-2-1-Master选举" class="headerlink" title="1.2.1 Master选举"></a>1.2.1 Master选举</h6><p>在分布式系统中，Master往往用来协调集群中其他系统单元，具有对分布式系统状态变更的决定权，如在读写分离的应用场景中，客户端的写请求往往是由Master来处理，或者其常常处理一些复杂的逻辑并将处理结果同步给其他系统单元。利用Zookeeper的强一致性，能够很好地保证在分布式高并发情况下节点的创建一定能够保证全局唯一性，即Zookeeper将会保证客户端无法重复创建一个已经存在的数据节点。</p>
<p>首先创建/master_election/节点，客户端集群往该节点下创建临时节点，这个过程中，只有一个客户端能够成功创建，此时其变成master，其他节点都会在节点上/master_election/注册一个子节点变更的Watcher，用于监控当前的Master机器是否存活，一旦发现当前Master挂了，其余客户端将会重新进行Master选举。</p>
<h6 id="1-2-2-分布式锁"><a href="#1-2-2-分布式锁" class="headerlink" title="1.2.2 分布式锁"></a>1.2.2 分布式锁</h6><p>分布式锁用于控制分布式系统之间同步访问共享资源的一种方式，可以保证不同系统访问一个或一组资源时的一致性，主要分为排它锁和共享锁。</p>
<p><strong>排它锁又称为写锁或独占锁</strong>，若事务T1对数据对象O1加上了排它锁，那么在整个加锁期间，只允许事务T1对O1进行读取和更新操作，其他任何事务都不能再对这个数据对象进行任何类型的操作，直到T1释放了排它锁。</p>
<p><strong>共享锁又称为读锁</strong>，若事务T1对数据对象O1加上共享锁，那么当前事务只能对O1进行读取操作，其他事务也只能对这个数据对象加共享锁，直到该数据对象上的所有共享锁都被释放。</p>
<blockquote>
<p>Zookeeper 强大的选举功能和稳定的分布式锁的功能是我们选择它的原因。</p>
</blockquote>
<h4 id="2-缓存-Redis"><a href="#2-缓存-Redis" class="headerlink" title="2. 缓存-Redis"></a>2. 缓存-Redis</h4><h5 id="2-1-Redis的介绍"><a href="#2-1-Redis的介绍" class="headerlink" title="2.1 Redis的介绍"></a>2.1 Redis的介绍</h5><p>Redis 是完全开源免费的，遵守BSD协议，是一个高性能的key-value数据库。</p>
<p>Redis 与其他 key-value 缓存产品有以下三个特点：</p>
<ul>
<li>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li>
<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li>
<li>Redis支持数据的备份，即master-slave模式的数据备份。</li>
</ul>
<h5 id="2-2-Redis-vs-MongDB"><a href="#2-2-Redis-vs-MongDB" class="headerlink" title="2.2 Redis vs MongDB"></a>2.2 Redis vs MongDB</h5><h6 id="2-2-1-Workload-B"><a href="#2-2-1-Workload-B" class="headerlink" title="2.2.1 Workload B"></a>2.2.1 Workload B</h6><p>以下是2500万个操作工作负载的吞吐量/延迟数，读/写比率为95％/ 5％。这将是一个代表性的缓存读取工作量：</p>
<p><img src="/2019/04/20/生产机器搭建计划/redis\1.png" alt></p>
<p><em>注意：吞吐量相对于主轴（左）绘制，而延迟针对副轴（右）绘制。</em></p>
<p>Workload B运行期间的观察：</p>
<ul>
<li>对于MongoDB，CPU已经饱和了32个线程。使用率超过300％，单位数闲置百分比。</li>
<li>对于Redis，CPU利用率从未超过95％。<strong>因此，Redis在单个线程上运行时始终比MongoDB表现更好，而MongoDB则使机器的所有内核饱和。</strong></li>
<li>对于Redis，在128个线程中，运行失败通常会出现读取超时异常。</li>
</ul>
<h6 id="2-2-2-Workload-A性能"><a href="#2-2-2-Workload-A性能" class="headerlink" title="2.2.2 Workload A性能"></a>2.2.2 Workload A性能</h6><p>以下是2500万个操作工作负载的吞吐量/延迟数。读/写比率为50％/ 50％：</p>
<p><img src="/2019/04/20/生产机器搭建计划/redis\2.png" alt></p>
<p><em>注意：吞吐量相对于主轴（左）绘制，而延迟针对副轴（右）绘制。</em></p>
<p>在Workload A运行期间的观察：</p>
<ul>
<li>对于MongoDB，CPU已经饱和了32个线程。使用率超过300％，单位数闲置百分比。</li>
<li>对于Redis，CPU利用率从未超过95％。</li>
<li>对于Redis，通过64个线程及更高版本，运行失败通常会出现读取超时异常。</li>
</ul>
<h6 id="2-2-3-插入工作负载性能"><a href="#2-2-3-插入工作负载性能" class="headerlink" title="2.2.3 插入工作负载性能"></a>2.2.3 插入工作负载性能</h6><p>最后，这是250万条记录插入工作负载的吞吐量/延迟数。选择记录数以确保Redis中的总内存使用率不超过80％</p>
<p><img src="/2019/04/20/生产机器搭建计划/redis\3.png" alt></p>
<p><em>注意：吞吐量相对于主轴（左）绘制，而延迟针对副轴（右）绘制。</em></p>
<p>插入工作负载运行期间的观察：</p>
<ul>
<li>对于MongoDB，CPU已经饱和了32个线程。使用率超过300％，单位数闲置百分比。</li>
<li>对于Redis，CPU利用率从未超过95％。</li>
</ul>
<h4 id="3-分布式文件存储-FastDFS"><a href="#3-分布式文件存储-FastDFS" class="headerlink" title="3. 分布式文件存储-FastDFS"></a>3. 分布式文件存储-FastDFS</h4><h5 id="3-1-FastDFS介绍"><a href="#3-1-FastDFS介绍" class="headerlink" title="3.1 FastDFS介绍"></a>3.1 FastDFS介绍</h5><p>FastDFS是一款类GoogleFS的开源分布式文件系统，它用纯C语言实现，支持Linux、FreeBSD、AIX等UNIX系统。它只能通过专有API对文件进行存取访问，不支持POSIX接口方式，不能mount使用。准确地讲，GoogleFS以及FastDFS、mogileFS、HDFS、TFS等类GoogleFS都不是系统级的分布式文件系统，而是应用级的分布式文件存储服务。</p>
<p>FastDFS是为互联网应用量身定做的分布式文件系统，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标。和现有的类Google FS分布式文件系统相比，FastDFS的架构和设计理念有其独到之处，主要体现在轻量级、分组方式和对等结构三个方面。</p>
<p>FastDFS是由国人余庆开发，其项目地址：<a href="https://link.jianshu.com/?t=https%3A%2F%2Fgithub.com%2Fhappyfish100" target="_blank" rel="noopener">https://github.com/happyfish100</a> 。</p>
<h5 id="3-2-FS-比较"><a href="#3-2-FS-比较" class="headerlink" title="3.2  FS 比较"></a>3.2  FS 比较</h5><div class="table-container">
<table>
<thead>
<tr>
<th>文件系统</th>
<th style="text-align:center">TFS</th>
<th style="text-align:center">FastDFS</th>
<th style="text-align:center">MogileFS</th>
<th style="text-align:center">MooseFS</th>
<th style="text-align:center">GlusterFS</th>
<th style="text-align:center">Ceph</th>
</tr>
</thead>
<tbody>
<tr>
<td>开发语言</td>
<td style="text-align:center">C++</td>
<td style="text-align:center">C</td>
<td style="text-align:center">Perl</td>
<td style="text-align:center">C</td>
<td style="text-align:center">C</td>
<td style="text-align:center">C++</td>
</tr>
<tr>
<td>开源协议</td>
<td style="text-align:center">GPL V2</td>
<td style="text-align:center">GPL V3</td>
<td style="text-align:center">GPL</td>
<td style="text-align:center">GPL V3</td>
<td style="text-align:center">GPL V3</td>
<td style="text-align:center">LGPL</td>
</tr>
<tr>
<td>数据存储方式</td>
<td style="text-align:center">块</td>
<td style="text-align:center">文件/Trunk</td>
<td style="text-align:center">文件</td>
<td style="text-align:center">块</td>
<td style="text-align:center">文件/块</td>
<td style="text-align:center">对象/文件/块</td>
</tr>
<tr>
<td>集群节点通信协议</td>
<td style="text-align:center">TCP</td>
<td style="text-align:center">TCP</td>
<td style="text-align:center">HTTP</td>
<td style="text-align:center">TCP</td>
<td style="text-align:center">TCP</td>
<td style="text-align:center">TCP</td>
</tr>
<tr>
<td>专用元数据存储点</td>
<td style="text-align:center">占用NS</td>
<td style="text-align:center">无</td>
<td style="text-align:center">占用DB</td>
<td style="text-align:center">占用MFS</td>
<td style="text-align:center">无</td>
<td style="text-align:center">占用MDS</td>
</tr>
<tr>
<td>在线扩容</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td>冗余备份</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td>单点故障</td>
<td style="text-align:center">存在</td>
<td style="text-align:center">不存在</td>
<td style="text-align:center">存在</td>
<td style="text-align:center">存在</td>
<td style="text-align:center">不存在</td>
<td style="text-align:center">存在</td>
</tr>
<tr>
<td>跨集群同步</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">部分支持</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">不适用</td>
</tr>
<tr>
<td>易用性</td>
<td style="text-align:center">安装复杂，官方文档少</td>
<td style="text-align:center">安装简单，社区相对活跃</td>
<td style="text-align:center">-</td>
<td style="text-align:center">安装简单，官方文档多</td>
<td style="text-align:center">安装简单，官方文档专业化</td>
<td style="text-align:center">安装简单，官方文档专业化</td>
</tr>
<tr>
<td>适用场景</td>
<td style="text-align:center">跨集群的小文件</td>
<td style="text-align:center">单集群的中小文件</td>
<td style="text-align:center">-</td>
<td style="text-align:center">单集群的大中文件</td>
<td style="text-align:center">跨集群云存储</td>
<td style="text-align:center">单集群的大中小文件</td>
</tr>
</tbody>
</table>
</div>
<p>开源协议说明:</p>
<p>GPL: 不允许修改后和衍生的代码做为闭源的商业软件发布和销售，修改后该软件产品必须也采用GPL协议<br>GPL V2：修改文本的整体就必须按照GPL流通，不仅该修改文本的源码必须向社会公开，而且对于这种修改文本的流通不准许附加修改者自己作出的限制。<br>GPL V3：要求用户公布修改的源代码，还要求公布相关硬件。</p>
<p>LGPL：更宽松的GPL。</p>
<h4 id="4-消息队列-Kafka"><a href="#4-消息队列-Kafka" class="headerlink" title="4. 消息队列-Kafka"></a>4. 消息队列-Kafka</h4><h5 id="4-1-Kafka的介绍"><a href="#4-1-Kafka的介绍" class="headerlink" title="4.1 Kafka的介绍"></a>4.1 Kafka的介绍</h5><p>Kafka是一种分布式的，基于发布/订阅的消息系统。主要设计目标如下：</p>
<ul>
<li>以时间复杂度为O(1)的方式提供消息持久化能力，即使对TB级以上数据也能保证常数时间复杂度的访问性能</li>
<li>高吞吐率。即使在非常廉价的商用机器上也能做到单机支持每秒100K条以上消息的传输</li>
<li>支持Kafka Server间的消息分区，及分布式消费，同时保证每个Partition内的消息顺序传输</li>
<li>同时支持离线数据处理和实时数据处理</li>
<li>Scale out：支持在线水平扩展</li>
</ul>
<h5 id="4-2-MQ对比"><a href="#4-2-MQ对比" class="headerlink" title="4.2 MQ对比"></a>4.2 MQ对比</h5><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">特性</th>
<th style="text-align:center">ActiveMQ</th>
<th style="text-align:center">RabbitMQ</th>
<th style="text-align:center"><strong>RocketMQ</strong></th>
<th style="text-align:center"><strong>Kafka</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>单机吞吐量</strong></td>
<td style="text-align:center">万级</td>
<td style="text-align:center">万级</td>
<td style="text-align:center">十万级</td>
<td style="text-align:center">十万级</td>
</tr>
<tr>
<td style="text-align:center"><strong>时效性</strong></td>
<td style="text-align:center">毫秒级</td>
<td style="text-align:center">毫秒级</td>
<td style="text-align:center">微秒级</td>
<td style="text-align:center">毫秒级</td>
</tr>
<tr>
<td style="text-align:center"><strong>可用性</strong></td>
<td style="text-align:center">高(主从)</td>
<td style="text-align:center">高(主从)</td>
<td style="text-align:center">非常高(分布式)</td>
<td style="text-align:center">非常高(分布式)</td>
</tr>
<tr>
<td style="text-align:center"><strong>消息丢失</strong></td>
<td style="text-align:center">低</td>
<td style="text-align:center">低</td>
<td style="text-align:center">理论上不会丢失</td>
<td style="text-align:center">理论上不会丢失</td>
</tr>
<tr>
<td style="text-align:center"><strong>文档完备性</strong></td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
</tr>
<tr>
<td style="text-align:center"><strong>社区活跃度</strong></td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
</tr>
<tr>
<td style="text-align:center"><strong>多语言支持</strong></td>
<td style="text-align:center">支持，java优先</td>
<td style="text-align:center">语言无关</td>
<td style="text-align:center">只支持java</td>
<td style="text-align:center">支持，java优先</td>
</tr>
<tr>
<td style="text-align:center"><strong>社区活跃度</strong></td>
<td style="text-align:center">一般</td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
<td style="text-align:center">很高</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>ActiveMQ之前用的比较多，但是现在确实大家用的不多了，没经过大规模吞吐量场景的验证，社区活跃度很低。</p>
</li>
<li><p>RabbitMQ由于是erlang语言编写的在性能方面确实有其优势，但是确实erlang语言阻止了大量的java工程师去深入研究和掌控他，对公司而言，几乎处于不可控的状态，但是确实人家是开源的，比较稳定的支持，活跃度也高。</p>
</li>
<li><p>RocketMQ作为阿里的开源MQ还是很不错的，之前还会担心社区万一突然黄掉的风险，现在捐赠给Apache之后也就没有这个问题了。</p>
</li>
<li><p>Kafka如果是大数据领域的实时计算、日志采集等场景，用Kafka是业内标准的，绝对没问题，社区活跃度很高，绝对不会黄，何况几乎是全世界这个领域的事实性规范。</p>
</li>
</ul>
<blockquote>
<p>对于我们目前的业务,任何一个MQ都可以满足我们现阶段的要求，但是考虑到后期我们可能需要一个其他方面的功能。又因为Kafka本身是个很强大的MQ,它在日志收集、实时计算的领域很强大是其他的MQ不能比拟的，考虑到后期我们可能会用到Kafka的日志收集等功能，所以目前使用的是Kafka集群。</p>
</blockquote>
<h3 id="部署计划"><a href="#部署计划" class="headerlink" title="部署计划"></a>部署计划</h3><p><img src="/2019/04/20/生产机器搭建计划/服务器拓扑图.jpg" alt></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/20/数据结构与算法学习笔记-chapter1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="铜豌豆6号">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/timg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张雨阳的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/20/数据结构与算法学习笔记-chapter1/" itemprop="url">数据结构与算法学习笔记(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-20T10:07:00+08:00">
                2019-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据结构与算法/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构与算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/20/数据结构与算法学习笔记-chapter1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/03/20/数据结构与算法学习笔记-chapter1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/03/20/数据结构与算法学习笔记-chapter1/" class="leancloud_visitors" data-flag-title="数据结构与算法学习笔记(一)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="为什么要学习数据结构和算法呢"><a href="#为什么要学习数据结构和算法呢" class="headerlink" title="为什么要学习数据结构和算法呢?"></a>为什么要学习数据结构和算法呢?</h2><ol>
<li>最近这段时间看了好多技术和文档，但每一次想深入去了解的时候都会涉及到数据结构。</li>
<li>想在这个行业上越走越远, 作为一个非计算机专业的人, 计算机原理和组成和数据结构和算法都是我必须要补充的东西。</li>
<li>想写出更优雅和效率更高的代码。</li>
</ol>
<h2 id="数据结构与算法"><a href="#数据结构与算法" class="headerlink" title="数据结构与算法"></a>数据结构与算法</h2><h3 id="数据结构与算法的定义"><a href="#数据结构与算法的定义" class="headerlink" title="数据结构与算法的定义"></a>数据结构与算法的定义</h3><ul>
<li>广义上讲: <strong>数据结构</strong>: 是一组数据的<strong>存储结构</strong>。<strong>算法</strong>: 操作数据的<strong>一组方法</strong>。</li>
<li>狭义上讲: 某些著名的数据结构和算法。例如: 队列、栈、堆、二分查找等。</li>
</ul>
<p>图书馆储藏书籍，为了方便查找，图书管理员一般会将书籍分门别类进行“存储”。按照一定规律编号，就是书籍这种“数据”的存储结构。</p>
<p>那我们如何来查找一本书呢？有很多种办法，你当然可以一本一本地找，也可以先根据书籍类别的编号，是人文，还是科学、计算机，来定位书架，然后再依次查找。这些查找方法都是算法。</p>
<h3 id="数据结构与算法的关系"><a href="#数据结构与算法的关系" class="headerlink" title="数据结构与算法的关系"></a>数据结构与算法的关系</h3><p><strong>数据结构和算法是相辅相成的, 数据结构是为算法服务的，算法要作用在特定的数据结构之上。</strong></p>
<blockquote>
<p>例如: 数组具有随机访问的特点，常用的二分查找算法需要用数组来存储数据。但如果选择链表这种数据结构，二分查找算法就无法工作了，因为链表并不支持随机访问。</p>
</blockquote>
<h3 id="常见的数据结构和算法"><a href="#常见的数据结构和算法" class="headerlink" title="常见的数据结构和算法"></a>常见的数据结构和算法</h3><ul>
<li><strong>常用的10个数据结构</strong>:  数组、链表、栈、队列、散列表、二叉树、堆、跳表、图、Trie树。</li>
<li><strong>常用的10个算法</strong>: 递归、排序、二分查找、搜索、哈希算法、贪心算法、分治算法、回溯算法、动态规划、字符串匹配算法。</li>
</ul>
<h3 id="学习数据结构与算法的小技巧"><a href="#学习数据结构与算法的小技巧" class="headerlink" title="学习数据结构与算法的小技巧"></a>学习数据结构与算法的小技巧</h3><ul>
<li>边学边练，<a href="https://leetcode.com/" target="_blank" rel="noopener">适度刷题</a></li>
<li>多问、多思考、多互动</li>
<li>知识需要沉淀，不要想试图一下子掌握所有</li>
</ul>
<h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p><strong>复杂度分析是整个算法学习的精髓，只要掌握了它，数据结构和算法的内容基本掌握了一半</strong></p>
<h4 id="为什么要有复杂度分析"><a href="#为什么要有复杂度分析" class="headerlink" title="为什么要有复杂度分析?"></a>为什么要有复杂度分析?</h4><p>把代码跑一遍，通过统计、监控，就能得到算法的执行时间和占用空间大小。为什么还要做时间、空间复杂度分析?  </p>
<p>这种评估算法执行效率的方法是正确的。很多数据结构和算法的书籍还给起了一个名字，叫<strong>事后统计法</strong>。但是这种方法有非常大的<strong>局限性</strong>。</p>
<ol>
<li><p>测试结果非常依赖测试环境  </p>
</li>
<li><p>测试结果受数据规模影响很大</p>
</li>
</ol>
<blockquote>
<p>我们需要一个不用<strong>具体的</strong>测试数据和测试，就可以<strong>粗略</strong>地估计<strong>算法的执行效率</strong>的方法。这就是<strong>时间复杂度</strong>和<strong>空间复杂度分析</strong>。</p>
</blockquote>
<h4 id="大O复杂度表示法"><a href="#大O复杂度表示法" class="headerlink" title="大O复杂度表示法"></a>大O复杂度表示法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line"><span class="number">2</span>   <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="number">3</span>   <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="number">4</span>   <span class="keyword">for</span>(; i&lt;=n;++i)&#123;</span><br><span class="line"><span class="number">5</span>      sum = sum + i;</span><br><span class="line"><span class="number">6</span>   &#125;</span><br><span class="line"><span class="number">7</span>   <span class="keyword">return</span> sum;</span><br><span class="line"><span class="number">8</span> &#125;</span><br></pre></td></tr></table></figure>
<p>假设每行代码的执行时间都一样，为unit_time。在这个假设的基础上，该段代码的总执行时间 T(n) 是多少呢?</p>
<p>第2、3行代码每行都需要1个unit_time的时间，第4、5行每行都执行了n遍，需要 2n <em>unit_time的时间，所以这段代码总的执行时间为 (2n + 2) </em> unit_time。可以看出来，<strong>所有的代码执行时间 T(n)与每行代码的执行次数n成正比。</strong> </p>
<p>我们把这个规律总结成一个公式 :</p>
<script type="math/tex; mode=display">
T(n) = O(f(n))</script><blockquote>
<p>n:  表示数据规模的大小<br>f(n):  表示执行代码的次数总和<br>O:  表示T(n)与f(n)成正比</p>
</blockquote>
<p>大O时间复杂度实际上并不具体表示代码的真正执行时间，而是表示代码执行时间随着数据规模增长的变化趋势，所以，也叫<strong>渐进时间复杂度</strong>，简称<strong>时间复杂度</strong>。</p>
<blockquote>
<p>当n很大时，低阶、常量和系数并不能左右增长趋势，所以都可以忽略，我们只要记录最大的量级就可以了。</p>
</blockquote>
<h4 id="时间复杂度分析技巧"><a href="#时间复杂度分析技巧" class="headerlink" title="时间复杂度分析技巧"></a>时间复杂度分析技巧</h4><ul>
<li><p>只关注执行次数最多的一段代码</p>
</li>
<li><p>加法法则: 总时间复杂度等于量级最大的那段代码的时间复杂度</p>
</li>
<li><p>乘法法则: 嵌套代码的复杂度等于嵌套内外代码复杂度的乘积</p>
</li>
</ul>
<h4 id="几种常见的时间复杂度实例分析"><a href="#几种常见的时间复杂度实例分析" class="headerlink" title="几种常见的时间复杂度实例分析?"></a>几种常见的时间复杂度实例分析?</h4><p><img src="/2019/03/20/数据结构与算法学习笔记-chapter1/1.png" alt></p>
<blockquote>
<p>非多项式量级: 当n逐渐增大时，执行时间会急剧增加。</p>
</blockquote>
<h4 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h4><p>有人说我们项目之前都会进行性能测试，再做代码的时间复杂度、空间复杂度分析，是不是多此一举呢? 而且，每段代码都分析一下时间复杂度、空间复杂度，是不是很浪费时间呢? 你怎么看待这个问题?</p>
<pre><code>答: (1) 渐进时间复杂度和渐进空间复杂度为我们提供了一个很好的理论分析的方向，它与平台无关，能够让我们对一个程序或算法有一个特定的认识。让我们知道在最坏的情况下，效率是如何的。

     (2) 渐进时间复杂度和渐进空间复杂度只是一个理论模型，只能粗略的给出分析，我们不能直接就断定`O(logn)`就一定比`O(n)`快，针对不同的情况进行一定的基准性能测试是有必要的。最终选择最优的算法。

   (3) 所以时间复杂度、空间复杂度分析和性能测试并不冲突, 这两个是相辅相成的，但是一个低价的时间复杂度有极大的可能会优于高阶的时间复杂度程序。所以在实际编程中，时刻关注理论时间、空间模型是有助于产出效率高的程序的。同时，因为渐进式时间、空间复杂度只是一个粗略的时间模型，并不会浪费太多时间，重点在于编程，要具有这种复杂度分析的思维。
</code></pre><h4 id="最好、最坏、平均、均摊复杂度"><a href="#最好、最坏、平均、均摊复杂度" class="headerlink" title="最好、最坏、平均、均摊复杂度"></a>最好、最坏、平均、均摊复杂度</h4><h5 id="最好、最坏时间复杂度"><a href="#最好、最坏时间复杂度" class="headerlink" title="最好、最坏时间复杂度"></a>最好、最坏时间复杂度</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// n表示数组 array 的长度</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> n, <span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> pos = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(; i&lt;n; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(array[i] == x)&#123;</span><br><span class="line">            pos = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>思路分析</strong>:  如果数组中<strong>第一个元素</strong>正好是要查找的变量x，那就不需要继续遍历剩下n-1个数据，那时间复杂度就是 <strong>O(1)</strong>。但如果数组中不存在x, 那我们就需要将数组都遍历一编，时间复杂度就成了<strong>O(n)</strong>。所以，不同的情况下，这段代码的时间复杂度是不一样的。</p>
<p>为了表示不同情况下的不同时间复杂度，我们需要引入三个概念: <strong>最好情况时间复杂度</strong>、<strong>最坏情况时间复杂度</strong>和<strong>平均时间复杂度</strong>。</p>
<ul>
<li><p>最好情况时间复杂度: 在最理想的情况下，执行这段代码的时间复杂度。</p>
</li>
<li><p>最坏情况时间复杂度: 在最糟糕的情况下，执行这段代码的时间复杂度。</p>
<blockquote>
<p>最好情况时间复杂度和最坏情况时间复杂度对应的都是极端情况下的代码复杂度。</p>
</blockquote>
</li>
</ul>
<h5 id="平均情况时间复杂度"><a href="#平均情况时间复杂度" class="headerlink" title="平均情况时间复杂度"></a>平均情况时间复杂度</h5><p>要查找的变量 x 在数组中的位置，我们知道，要查找的变量 x，要么在数组里，要么就不在数组里。这两种情况对应的概率统计起 来很麻烦，为了方便你理解，我们假设在数组中与不在数组中的概率都为 1/2。另外，要查找的 数据出现在 0～n-1 这 n 个位置的概率也是一样的，为 1/n。所以，根据概率乘法法则，要查找 的数据出现在  0～n-1 中任意位置的概率就是 1/(2n)。</p>
<p><img src="/2019/03/20/数据结构与算法学习笔记-chapter1/2.png" alt></p>
<p>这个值就是概率论中的<strong>加权平均值</strong>，也叫作<strong>期望值</strong>，所以平均时间复杂度的全称应该叫<strong>加权平均间复杂度</strong>或者<strong>期望时间复杂度</strong></p>
<h5 id="均摊时间复杂度"><a href="#均摊时间复杂度" class="headerlink" title="均摊时间复杂度"></a>均摊时间复杂度</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (count == array.length) &#123;</span><br><span class="line">		<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; ++i) &#123; </span><br><span class="line">            sum = sum + array[i];</span><br><span class="line">		&#125;</span><br><span class="line">		array[<span class="number">0</span>] = sum; </span><br><span class="line">        count = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">		array[count] = val;</span><br><span class="line">		++count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码实现了一个往数组中插入数据的功能。当数组满了之后，也就是代码中的 count == array.length 时，我们用 for 循环遍历数组求和，并清空数组，将求和 之后的 sum 值放到数组的第一个位置，然后再将新的数据插入。但如果数组一开始就有空闲空间，则直接将数据插入数组。</p>
<p>那这段代码的时间复杂度是多少呢？你可以先用我们刚讲到的三种时间复杂度的分析方法来分析 一下。</p>
<p>最理想的情况下，数组中有空闲空间，我们只需要将数据插入到数组下标为 count 的位置就可 以了，所以最好情况时间复杂度为 O(1)。最坏的情况下，数组中没有空闲空间了，我们需要先做 一次数组的遍历求和，然后再将数据插入，所以最坏情况时间复杂度为  O(n)。</p>
<p>我们 先来对比一下这个  insert()  的例子和前面那个  ﬁnd() 的例子，你就会发现这两者有很大差别？</p>
<p>首先，ﬁnd()  函数在极端情况下，复杂度才为  O(1)。但  insert() 在大部分情况下，时间复杂度都为 O(1)。只有个别情况下，复杂度才比较高，为 O(n)。这是 insert()第一个区别于 ﬁnd() 的地 方。</p>
<p>我们再来看第二个不同的地方。对于 insert() 函数来说，O(1) 时间复杂度的插入和 O(n) 时间复 杂度的插入，出现的频率是非常有规律的，而且有一定的前后时序关系，一般都是一个 O(n) 插 入之后，紧跟着 n-1 个 O(1)  的插入操作，循环往复。</p>
<p>针对这种特殊的场景，我们引入了一种更加简单的分析方法：摊还分析法，通过摊还分析得到的 时间复杂度我们起了一个名字，叫<strong>均摊时间复杂度</strong>。</p>
<p>继续看在数组中插入数据的这个例子。每一次 O(n) 的插入操作，都会跟着 n-1 次 O(1) 的插入操作，所以把耗时多的那次操作均摊到接下来的 n-1 次耗时少的操作上，均摊下来，这一 组连续的操作的均摊时间复杂度就是 O(1)。这就是均摊分析的大致思路。</p>
<h5 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局变量，大小为10的数组array，长度 len，下标i</span></span><br><span class="line"><span class="keyword">int</span> array[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">int</span> len = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>；</span><br><span class="line"></span><br><span class="line"><span class="comment">// 往数组中添加一个元素</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> element)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (i &gt;= len) &#123; <span class="comment">// 数组空间不够了</span></span><br><span class="line">		<span class="comment">// 重新申请一个2倍大小的数组空间</span></span><br><span class="line">		<span class="keyword">int</span> new_array[] = <span class="keyword">new</span> <span class="keyword">int</span>[len*<span class="number">2</span>];		</span><br><span class="line">		<span class="comment">// 把原来array数组中的数据依次copy到new_array</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; ++j) &#123; </span><br><span class="line">			new_array[j] = array[j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// new_array复制给array，array现在大小就是2倍len了		</span></span><br><span class="line">		array = new_array; </span><br><span class="line">		len = <span class="number">2</span> * len;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 将 element放到下标为i的位置，下标i加一</span></span><br><span class="line">	array[i] = element;</span><br><span class="line">	++i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>答: 最好时间复杂度O(1)、最坏时间复杂度O(n)、均摊时间复杂度O(1)</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/16/我为什么写博客/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="铜豌豆6号">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/timg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张雨阳的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/16/我为什么写博客/" itemprop="url">我为什么写博客？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-16T11:13:00+08:00">
                2019-03-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/程序人生/" itemprop="url" rel="index">
                    <span itemprop="name">程序人生</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/16/我为什么写博客/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/03/16/我为什么写博客/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/03/16/我为什么写博客/" class="leancloud_visitors" data-flag-title="我为什么写博客？">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="记录下自己的学习过程"><a href="#记录下自己的学习过程" class="headerlink" title="记录下自己的学习过程"></a>记录下自己的学习过程</h3><p>作为一个Java学习者，要学习的东西实在太多了。各种类型的框架实在是太多了，但工作中能用到的东西实在有限。我也没有那种过目不忘的本领，在工作中很多技术都不会到，所以很多看过的技术随着时间很快就忘记了。而且很多技术当你写下来的时候和看到时候的理解会不太一样，经常会有更<strong>深刻的理解</strong>，这样记的就更牢固了。</p>
<blockquote>
<p><strong>好记性不如烂笔头</strong></p>
</blockquote>
<h3 id="完善自己的知识体系"><a href="#完善自己的知识体系" class="headerlink" title="完善自己的知识体系"></a>完善自己的知识体系</h3><p>现在各种技术的学习路线图，网上实在是太多了，让人眼花缭乱。我开始都是喜欢看到就跟着学一下，以为很适合自己，当自己跟着学习一段时间之后就会有疑问，时不时又问自己这种路线是否真的适合自己呢？我这又是何苦呢?</p>
<p>我觉得每一个都应该有自己的学习方式和知识体系，只有适合自己的才是最好的。可能没用别人的那么全面，但自己的知识体系中的每一点都是真正属于自己的，我可以慢慢的去补充完善它。而不是直接把别人的拿过来就用，根本不考虑是否适合自己。</p>
<blockquote>
<p>就跟你自己找女朋友一样的，每个人都有自己喜欢的类型。适合自己的才是最好的，自己去慢慢追求过来的肯定比别人直接给你塞一个要更合适一些。</p>
</blockquote>
<h3 id="提升自己的语言表达"><a href="#提升自己的语言表达" class="headerlink" title="提升自己的语言表达"></a>提升自己的语言表达</h3><p>我是一个语言表达能力及其差的人，差到有些时候自己都不敢相信。别人很容易弄懂的一句话，我就是半天也弄不懂。我希望通过博客来提升下自己的语言表达水准，毕竟是要放在网上给人看的。我总不能经常语句不通顺，表述不清楚吧，这样我写文字的时候可能需要反复斟酌，希望自己能有所提升吧。</p>
<blockquote>
<p>ps: 明年这个时候，我再回来看看自己是否有所进步。</p>
</blockquote>
<h3 id="牛人都这么做"><a href="#牛人都这么做" class="headerlink" title="牛人都这么做"></a>牛人都这么做</h3><p>在我能接触到的圈子里。我发现牛人都喜欢写博客，都有很多的博文，那是我认为他是牛人的代表作，这也是我认为这是牛人谓之牛人的原因。我如果坚持照做，我也就会成为牛人。说白了，这从头到尾就是一种低级的模仿，不明所以的跟随而已。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><strong>屌丝程序员的逆袭一般分两步: 让自己变得牛逼， 让别人知道你牛逼。</strong> 我通过写博客来让自己更擅长归纳和抽象，也通过写博客来让别人知道我能胜任一工作。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/16/Hexo+Github Pages搭建博客和配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="铜豌豆6号">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/timg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张雨阳的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/16/Hexo+Github Pages搭建博客和配置/" itemprop="url">Hexo+Github Pages搭建博客和配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-16T11:13:00+08:00">
                2019-03-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hexo学习/" itemprop="url" rel="index">
                    <span itemprop="name">hexo学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/16/Hexo+Github Pages搭建博客和配置/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/03/16/Hexo+Github Pages搭建博客和配置/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/03/16/Hexo+Github Pages搭建博客和配置/" class="leancloud_visitors" data-flag-title="Hexo+Github Pages搭建博客和配置">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本来是想自己从头写的，由于之前操作的时候，自己没有截图保留，再次操作的时候截图有些不一样。所以我将直接将我搭建过程中的配置和过程参考的博客地址直接拿过来了，资源整合到了一起。我是参照这个过程搭建的，所以正常操作肯定是可以搭建成功的，<strong>请尊重作者的原创</strong>。</p>
<h2 id="搭建过程"><a href="#搭建过程" class="headerlink" title="搭建过程"></a>搭建过程</h2><ul>
<li><p><a href="https://juejin.im/entry/5a574864f265da3e3c6c1217" target="_blank" rel="noopener">如何搭建自己的博客</a></p>
<blockquote>
<p>这里面主题这一块，官方的我试了一些主题自己都没有那么满意，最后找到了一个我<code>NexT</code> 主题。大家可以选自己喜欢的，不一定要和我一样，一般<code>Github</code>地址上都会有详细的介绍，参照着一步步去使用就可以了，<strong>套路都是一样的</strong>，唯一要注意的有些主题可能需要安装一些<strong>额外的插件</strong>。</p>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 具体的请参照作者的要求</span></span><br><span class="line">npm install hexo-pagination --save</span><br></pre></td></tr></table></figure>
<ul>
<li><p><a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">NexT GitHub</a></p>
</li>
<li><p><a href="https://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">NexT官方文档</a></p>
</li>
<li><p><a href="https://linlif.github.io/2017/05/27/Hexo%E4%BD%BF%E7%94%A8%E6%94%BB%E7%95%A5-%E6%B7%BB%E5%8A%A0%E5%88%86%E7%B1%BB%E5%8F%8A%E6%A0%87%E7%AD%BE/" target="_blank" rel="noopener">Hexo 添加标签和分类</a></p>
</li>
</ul>
<blockquote>
<p>这里面修改文件的过程中一定要注意<strong>yml文件的格式</strong>问题。</p>
</blockquote>
<ul>
<li>将自己写好的md文档丢到<code>_posts</code>目录下，打开<code>git bash</code>命令行执行如下操作：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除一些缓存的记录,一定要执行之下。否则可能部署了将不生效</span></span><br><span class="line">hexo clean</span><br><span class="line"><span class="comment"># 生成新的静态文件</span></span><br><span class="line">hexo g</span><br><span class="line"><span class="comment"># 发布到GitHub</span></span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://yanyinhong.github.io/2017/05/02/How-to-insert-image-in-hexo-post/" target="_blank" rel="noopener">博客中如何添加本地图片</a></li>
<li><a href="https://www.jianshu.com/p/7ab21c7f0674" target="_blank" rel="noopener">博客中数学公式显示配置</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/timg.png" alt="铜豌豆6号">
            
              <p class="site-author-name" itemprop="name">铜豌豆6号</p>
              <p class="site-description motion-element" itemprop="description">安安静静的当一个码农</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">铜豌豆6号</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://铜豌豆6号.disqus.com/count.js" async></script>
    

    

  




	





  














  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("OnzY68wYNuEreJmz6UKQ6WDi-gzGzoHsz", "1B6bWk99L50mdp8qQsktSQWK");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
